# -*- coding: utf-8 -*-
# pylint: disable=line-too-long, unused-wildcard-import
"""
The *HydPy-SW1D* model family member |sw1d_gate_out| is a routing submodel, which
calculates the flow under a submerged gate.

Principally, |sw1d_gate_out| is similar to |sw1d_weir_out|, which calculates the flow
over a weir.  Both models must be placed at a network outlet.  However, while
|sw1d_weir_out| calculates free flow and thus requires no information from downstream
locations, |sw1d_gate_out| allows for flows in both directions depending on the
(dynamically calculated) upstream water level and an (externally supplied) downstream
water level.  Another key difference is that |sw1d_gate_out| allows model users to
define project specific-functions for controlling the gate opening.

Integration tests
=================

.. how_to_understand_integration_tests::

We create a test setting identical to the one of the |sw1d_channel| documentation,
except adding a |sw1d_gate_out| submodel at the channel outlet:

>>> from hydpy import pub
>>> pub.timegrids = "2000-01-01 00:00", "2000-01-01 05:00", "5m"

>>> from hydpy.models.sw1d_channel import *
>>> parameterstep()
>>> nmbsegments(8)
>>> lengths = 2.0, 3.0, 2.0, 3.0, 2.0, 3.0, 2.0, 3.0

>>> for i, length_ in enumerate(lengths):
...     with model.add_storagemodel_v1("sw1d_storage", position=i):
...         length(length_)
...         bottomlevel(5.0)
...         bottomwidth(5.0)
...         sideslope(0.0)

>>> for i in range(1, nmbsegments.value):
...     with model.add_routingmodel_v2("sw1d_lias", position=i):
...         lengthupstream(2.0 if i % 2 else 3.0)
...         lengthdownstream(3.0 if i % 2 else 2.0)
...         bottomlevel(5.0)
...         bottomwidth(5.0)
...         sideslope(0.0)
...         stricklercoefficient(1.0/0.03)
...         timestepfactor(0.7)
...         diffusionfactor(0.2)

>>> with model.add_routingmodel_v3("sw1d_gate_out", position=8):
...     lengthupstream(lengths[-1])
...     bottomlevel(5.0)
...     gateheight(6.5)
...     gatewidth(2.0)
...     flowcoefficient(0.6)
...     timestepfactor(0.7)

We need to connect two nodes with the |sw1d_gate_out| submodel.  One node for querying
the outflow, which must be connectible to the outlet sequence |sw1d_outlets.LongQ|.
And another node that supplies the downstream water levels, which must be connectible
to the receiver sequence |sw1d_receivers.WaterLevel|:

>>> from hydpy import Element, Node
>>> outflow = Node("outflow", variable="LongQ")
>>> waterlevel = Node("waterlevel", variable="WaterLevel")
>>> channel = Element("channel", outlets=outflow, receivers=waterlevel)
>>> channel.model = model

>>> from hydpy import IntegrationTest
>>> test = IntegrationTest(channel)
>>> test.plotting_options.axis1 = (factors.waterlevels,)

>>> def prepare_inits(hs):
...     if isinstance(hs, float):
...         hs = nmbsegments.value * [hs]
...     inits = []
...     for h, s in zip(hs, model.storagemodels):
...         c = s.parameters.control
...         v = h * c.bottomwidth * c.length
...         inits.append((s.sequences.states.watervolume, v))
...     for r in model.routingmodels[1:]:
...         inits.append((r.sequences.states.discharge, 0.0))
...     test.inits = inits

.. _sw1d_gate_out_low_outer_waterlevel:

Low outer water level
_____________________

The first example deals with a constant outer water level lower than the initial
upstream water level:

>>> waterlevel.sequences.sim.series = 6.0
>>> prepare_inits(hs=2.0)

The water gradient causes a downstream flow and, thus, falling upstream water levels.
There is no notable shift in behaviour when the upstream water loses contact with the
gate after about a half hour:

.. integration-test::

    >>> conditions = test("sw1d_gate_out_low_outer_waterlevel", get_conditions="2000-01-01 00:00")
    |                date | timestep |                                                                       waterlevels |                                                                            discharges |  outflow | waterlevel |
    --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    | 2000-01-01 00:00:00 |    300.0 |      7.0       7.0       7.0       7.0       7.0       7.0       7.0      6.84054 | 0.0       0.0       0.0       0.0       0.0       0.0       0.0       0.0    7.973004 | 7.973004 |        6.0 |
    | 2000-01-01 00:05:00 |    300.0 |      7.0       7.0       7.0       7.0       7.0       7.0  6.945481     6.738462 | 0.0       0.0       0.0       0.0       0.0       0.0       0.0  1.817298    6.921191 | 6.921191 |        6.0 |
    | 2000-01-01 00:10:00 |    300.0 |      7.0       7.0       7.0       7.0       7.0  6.987374  6.874537       6.6733 | 0.0       0.0       0.0       0.0       0.0       0.0    0.6313  2.996118    6.254197 | 6.254197 |        6.0 |
    | 2000-01-01 00:15:00 |    300.0 |      7.0       7.0       7.0       7.0  6.995552  6.954362  6.843308     6.613501 | 0.0       0.0       0.0       0.0       0.0  0.148258  1.798845  2.839794    5.829791 | 5.829791 |        6.0 |
    | 2000-01-01 00:20:00 |    300.0 |      7.0       7.0       7.0  6.998954  6.974556  6.928642  6.815668     6.563883 | 0.0       0.0       0.0       0.0  0.052289  0.752166  2.038193   2.95952      5.4404 |   5.4404 |        6.0 |
    | 2000-01-01 00:25:00 |    300.0 |      7.0       7.0  6.999631  6.991257  6.952415  6.909067  6.789464     6.521296 | 0.0       0.0       0.0  0.012308  0.397166  1.135184  2.113901  2.987387    5.116741 | 5.116741 |        6.0 |
    | 2000-01-01 00:30:00 |    300.0 |      7.0  6.999913  6.995335  6.978076  6.937773  6.891541  6.765109     6.484192 | 0.0       0.0  0.004346  0.147536  0.806565  1.294661  2.171003  2.982815    4.838009 | 4.838009 |        6.0 |
    | 2000-01-01 00:35:00 |    300.0 | 6.999969  6.998494   6.98586  6.964833  6.927103  6.875491  6.742387     6.451622 | 0.0  0.001023  0.071974   0.38781  1.049983  1.405649  2.208146  2.965559    4.594039 | 4.594039 |        6.0 |
    | 2000-01-01 00:40:00 |    300.0 | 6.999208  6.994191   6.97473  6.953933  6.916757  6.860787  6.721308     6.422833 | 0.0  0.025371    0.2405  0.611512  1.156498  1.501343  2.236548  2.939186    4.378668 | 4.378668 |        6.0 |
    | 2000-01-01 00:45:00 |    300.0 | 6.996127  6.987096  6.965669  6.944816  6.906164  6.846957  6.701853     6.397261 | 0.0  0.102719  0.457477  0.759512  1.215391  1.568503  2.259962  2.908463    4.187053 | 4.187053 |        6.0 |
    | 2000-01-01 00:50:00 |    300.0 | 6.989275  6.979004  6.958884  6.936733  6.895718  6.833671  6.683849     6.374468 | 0.0  0.228394  0.633028  0.859189  1.263334  1.611534  2.275849  2.875984    4.015633 | 4.015633 |        6.0 |
    | 2000-01-01 00:55:00 |    300.0 | 6.978849  6.971204  6.952884  6.929323    6.8857  6.820833  6.667091     6.354083 | 0.0  0.347526  0.737497  0.937479  1.307966  1.641909  2.283818  2.842405    3.861663 | 3.861663 |        6.0 |
    | 2000-01-01 01:00:00 |    300.0 | 6.966627  6.963535  6.946678  6.922282  6.876179  6.808462   6.65142     6.335787 | 0.0  0.407391  0.790845  0.997725  1.349792  1.667145  2.285674   2.80804    3.722844 | 3.722844 |        6.0 |
    | 2000-01-01 01:05:00 |    300.0 |  6.95457  6.955317  6.939916   6.91531   6.86708  6.796596  6.636725     6.319309 | 0.0  0.401917  0.812847  1.038242  1.386817  1.690122  2.283453  2.773301    3.597209 | 3.597209 |        6.0 |
    | 2000-01-01 01:10:00 |    300.0 | 6.943781  6.946279  6.932447  6.908183  6.858259  6.785241  6.622924     6.304419 | 0.0  0.359609  0.811472  1.060441  1.416821  1.710853  2.278609  2.738631    3.483089 | 3.483089 |        6.0 |
    | 2000-01-01 01:15:00 |    300.0 |  6.93439  6.936689  6.924219  6.900744  6.849575  6.774367   6.60995     6.290926 | 0.0  0.313035  0.792573  1.066851   1.43878  1.728245  2.271922  2.704405     3.37908 |  3.37908 |        6.0 |
    | 2000-01-01 01:20:00 |    300.0 | 6.925931  6.927028  6.915361  6.892897  6.840915  6.763919  6.597734     6.278664 | 0.0   0.28199  0.765027  1.060273  1.452641  1.741304  2.263694   2.67088    3.283999 | 3.283999 |        6.0 |
    | 2000-01-01 01:25:00 |    300.0 | 6.917804  6.917676  6.906171  6.884615  6.832195   6.75383  6.586208      6.26749 | 0.0  0.270883  0.738459  1.044801  1.458874  1.749527  2.253985  2.638183    3.196841 | 3.196841 |        6.0 |
    | 2000-01-01 01:30:00 |    300.0 | 6.909595  6.908763  6.896975  6.875962  6.823366  6.744031  6.575301     6.257282 | 0.0  0.273637  0.719323  1.025872  1.458532  1.752844  2.242784  2.606344    3.116738 | 3.116738 |        6.0 |
    | 2000-01-01 01:35:00 |    300.0 | 6.901165    6.9002  6.887986   6.86707   6.81442  6.734461  6.564944      6.24793 | 0.0  0.281004  0.709135  1.008748  1.453342  1.751553  2.230076  2.575325    3.042929 | 3.042929 |        6.0 |
    | 2000-01-01 01:40:00 |    300.0 | 6.892577  6.891814  6.879253  6.858095  6.805393   6.72507  6.555069     6.239337 | 0.0  0.286275  0.705562  0.996681  1.445427  1.746324  2.215888  2.545051    2.974737 | 2.974737 |        6.0 |
    | 2000-01-01 01:45:00 |    300.0 |  6.88396  6.883459  6.870699  6.849163   6.79635  6.715826  6.545616     6.231414 | 0.0  0.287219  0.704991  0.990107  1.436709  1.738133  2.200317  2.515428    2.911554 | 2.911554 |        6.0 |
    | 2000-01-01 01:50:00 |    300.0 | 6.875413  6.875064  6.862221  6.840341   6.78736  6.706716  6.536531     6.224085 | 0.0  0.284918  0.704679  0.987299   1.42839  1.728067   2.18355   2.48637     2.85283 |  2.85283 |        6.0 |
    | 2000-01-01 01:55:00 |    300.0 | 6.866965  6.866626  6.853749  6.831642  6.778472  6.697741  6.527772      6.21728 | 0.0  0.281585  0.703459  0.985851  1.420809  1.717069  2.165843   2.45781     2.79807 |  2.79807 |        6.0 |
    | 2000-01-01 02:00:00 |    300.0 | 6.858597  6.858178   6.84527  6.823047   6.76971  6.688906  6.519305     6.210938 | 0.0  0.278941  0.701324  0.983952  1.413685  1.705755  2.147477  2.429711    2.746825 | 2.746825 |        6.0 |
    | 2000-01-01 02:05:00 |    300.0 | 6.850269  6.849756  6.836805  6.814534  6.761075   6.68022  6.511104     6.205005 | 0.0  0.277593  0.698696   0.98085  1.406539  1.694381  2.128701  2.402063    2.698697 | 2.698697 |        6.0 |
    | 2000-01-01 02:10:00 |    300.0 | 6.841952  6.841382  6.828384  6.806086  6.752556  6.671685  6.503149     6.199436 | 0.0  0.277221  0.695922  0.976625  1.399006   1.68295  2.109708   2.37487    2.653337 | 2.653337 |        6.0 |
    | 2000-01-01 02:15:00 |    300.0 | 6.833639  6.833063  6.820026  6.797701  6.744144  6.663299  6.495423      6.19419 | 0.0  0.277116  0.693105  0.971699  1.390949   1.67136  2.090618  2.348144    2.610437 | 2.610437 |        6.0 |
    | 2000-01-01 02:20:00 |    300.0 | 6.825339  6.824793  6.811737  6.789382  6.735831   6.65506  6.487912     6.189233 | 0.0  0.276667  0.690151  0.966454   1.38241  1.659524  2.071502  2.321893    2.569733 | 2.569733 |        6.0 |
    | 2000-01-01 02:25:00 |    300.0 | 6.817071  6.816567  6.803513  6.781133  6.727613   6.64696    6.4806     6.184535 | 0.0  0.275606   0.68691  0.961069  1.373505  1.647414    2.0524  2.296117    2.530993 | 2.530993 |        6.0 |
    | 2000-01-01 02:30:00 |    300.0 | 6.808851  6.808381  6.795345  6.772957  6.719492  6.638995  6.473476     6.180071 | 0.0  0.273991   0.68328  0.955542  1.364335  1.635056  2.033338  2.270814    2.494018 | 2.494018 |        6.0 |
    | 2000-01-01 02:35:00 |    300.0 | 6.800689  6.800237  6.787229  6.764854  6.711465  6.631158  6.466527     6.175818 | 0.0  0.272052  0.679252  0.949791  1.354958  1.622502  2.014342  2.245972    2.458632 | 2.458632 |        6.0 |
    | 2000-01-01 02:40:00 |    300.0 | 6.792589   6.79214  6.779163  6.756821  6.703533  6.623445  6.459743     6.171756 | 0.0  0.270023  0.674896  0.943747   1.34539    1.6098  1.995435  2.221581    2.424683 | 2.424683 |        6.0 |
    | 2000-01-01 02:45:00 |    300.0 | 6.784547  6.784094  6.771151  6.748857  6.695692  6.615852  6.453113     6.167868 | 0.0  0.268047  0.670316  0.937398  1.335632  1.596986  1.976639  2.197628    2.392036 | 2.392036 |        6.0 |
    | 2000-01-01 02:50:00 |    300.0 | 6.776563  6.776105  6.763195  6.740959  6.687941  6.608374  6.446629     6.164138 | 0.0  0.266158  0.665604  0.930789  1.325686  1.584081   1.95797    2.1741    2.360572 | 2.360572 |        6.0 |
    | 2000-01-01 02:55:00 |    300.0 | 6.768633  6.768175    6.7553  6.733127  6.680275  6.601007  6.440283     6.160554 | 0.0  0.264319   0.66082  0.923992  1.315569  1.571099  1.939442  2.150985    2.330187 | 2.330187 |        6.0 |
    | 2000-01-01 03:00:00 |    300.0 | 6.760759  6.760305  6.747467  6.725362  6.672692  6.593747  6.434067     6.157104 | 0.0  0.262471  0.655989  0.917075  1.305311  1.558054  1.921063  2.128269     2.30079 |  2.30079 |        6.0 |
    | 2000-01-01 03:05:00 |    300.0 | 6.752942  6.752494  6.739698  6.717665  6.665192   6.58659  6.427974     6.153777 | 0.0  0.260575  0.651114  0.910088  1.294947  1.544961  1.902838  2.105938    2.272298 | 2.272298 |        6.0 |
    | 2000-01-01 03:10:00 |    300.0 | 6.745183  6.744743  6.731992  6.710036  6.657772  6.579531  6.421997     6.150563 | 0.0  0.258617  0.646189  0.903054   1.28451  1.531839  1.884773  2.083979     2.24464 |  2.24464 |        6.0 |
    | 2000-01-01 03:15:00 |    300.0 | 6.737485  6.737051  6.724349  6.702475  6.650432  6.572568  6.416132     6.147456 | 0.0   0.25661  0.641211  0.895982  1.274026   1.51871  1.866872  2.062379    2.217751 | 2.217751 |        6.0 |
    | 2000-01-01 03:20:00 |    300.0 | 6.729848  6.729418  6.716768  6.694982  6.643169  6.565697  6.410373     6.144447 | 0.0  0.254575  0.636186  0.888872  1.263514  1.505592  1.849138  2.041124    2.191575 | 2.191575 |        6.0 |
    | 2000-01-01 03:25:00 |    300.0 | 6.722272  6.721847   6.70925  6.687557  6.635984  6.558915  6.404714      6.14153 | 0.0   0.25253  0.631124  0.881725  1.252988  1.492501  1.831574  2.020203    2.166059 | 2.166059 |        6.0 |
    | 2000-01-01 03:30:00 |    300.0 | 6.714757  6.714336  6.701795  6.680199  6.628874  6.552221  6.399151     6.138699 | 0.0  0.250487  0.626036  0.874549  1.242458  1.479451  1.814184  1.999603    2.141159 | 2.141159 |        6.0 |
    | 2000-01-01 03:35:00 |    300.0 | 6.707304  6.706886  6.694402  6.672907  6.621839   6.54561  6.393681     6.135948 | 0.0  0.248448  0.620935  0.867353  1.231935  1.466452   1.79697  1.979315    2.116833 | 2.116833 |        6.0 |
    | 2000-01-01 03:40:00 |    300.0 | 6.699911  6.699497  6.687073  6.665682  6.614876  6.539082  6.388299     6.133274 | 0.0  0.246412  0.615829  0.860149  1.221428  1.453511  1.779932  1.959328    2.093045 | 2.093045 |        6.0 |
    | 2000-01-01 03:45:00 |    300.0 |  6.69258  6.692171  6.679806  6.658522  6.607985  6.532633  6.383002     6.130671 | 0.0  0.244377  0.610723  0.852947  1.210945  1.440638   1.76307  1.939632    2.069761 | 2.069761 |        6.0 |
    | 2000-01-01 03:50:00 |    300.0 |  6.68531  6.684905  6.672602  6.651427  6.601165  6.526262  6.377787     6.128137 | 0.0   0.24234  0.605622  0.845757  1.200497  1.427837  1.746386  1.920217    2.046952 | 2.046952 |        6.0 |
    | 2000-01-01 03:55:00 |    300.0 | 6.678101    6.6777   6.66546  6.644397  6.594414  6.519967  6.372651     6.125666 | 0.0  0.240303  0.600529  0.838584   1.19009  1.415114  1.729878  1.901076     2.02459 |  2.02459 |        6.0 |
    | 2000-01-01 04:00:00 |    300.0 | 6.670953  6.670557  6.658381  6.637431  6.587732  6.513746  6.367592     6.123257 | 0.0  0.238269  0.595448  0.831434  1.179732  1.402476  1.713546  1.882201    2.002653 | 2.002653 |        6.0 |
    | 2000-01-01 04:05:00 |    300.0 | 6.663865  6.663474  6.651363  6.630528  6.581117  6.507596  6.362606     6.120907 | 0.0   0.23624  0.590382  0.824312  1.169428  1.389926  1.697388  1.863582    1.981116 | 1.981116 |        6.0 |
    | 2000-01-01 04:10:00 |    300.0 | 6.656839  6.656452  6.644406  6.623689  6.574569  6.501518  6.357691     6.118612 | 0.0   0.23422  0.585335   0.81722  1.159184  1.377469  1.681404  1.845214    1.959962 | 1.959962 |        6.0 |
    | 2000-01-01 04:15:00 |    300.0 | 6.649873   6.64949  6.637511  6.616912  6.568085  6.495508  6.352847      6.11637 | 0.0  0.232209   0.58031  0.810163  1.149003  1.365108  1.665592  1.827088    1.939171 | 1.939171 |        6.0 |
    | 2000-01-01 04:20:00 |    300.0 | 6.642966  6.642588  6.630676  6.610198  6.561667  6.489566  6.348069      6.11418 | 0.0  0.230209  0.575311  0.803144  1.138889  1.352845   1.64995  1.809199    1.918727 | 1.918727 |        6.0 |
    | 2000-01-01 04:25:00 |    300.0 |  6.63612  6.635745  6.623901  6.603544  6.555312   6.48369  6.343357     6.112038 | 0.0  0.228221   0.57034  0.796166  1.128845  1.340684  1.634478   1.79154    1.898615 | 1.898615 |        6.0 |
    | 2000-01-01 04:30:00 |    300.0 | 6.629332  6.628962  6.617186  6.596951  6.549019  6.477879  6.338709     6.109944 | 0.0  0.226245  0.565399  0.789232  1.118875  1.328624  1.619172  1.774106    1.878821 | 1.878821 |        6.0 |
    | 2000-01-01 04:35:00 |    300.0 | 6.622604  6.622238   6.61053  6.590418  6.542788  6.472132  6.334123     6.107895 | 0.0  0.224281   0.56049  0.782346   1.10898  1.316669  1.604032   1.75689    1.859332 | 1.859332 |        6.0 |
    | 2000-01-01 04:40:00 |    300.0 | 6.615934  6.615572  6.603934  6.583945  6.536619  6.466447  6.329598      6.10589 | 0.0  0.222331  0.555615  0.775508  1.099162  1.304819  1.589055  1.739888    1.840138 | 1.840138 |        6.0 |
    | 2000-01-01 04:45:00 |    300.0 | 6.609322  6.608965  6.597395  6.577531  6.530509  6.460824  6.325133     6.103927 | 0.0  0.220394  0.550774  0.768721  1.089424  1.293075  1.574239  1.723094    1.821226 | 1.821226 |        6.0 |
    | 2000-01-01 04:50:00 |    300.0 | 6.602768  6.602415  6.590915  6.571176  6.524459  6.455261  6.320725     6.102006 | 0.0  0.218472  0.545969  0.761986  1.079767  1.281437  1.559583  1.706503    1.802587 | 1.802587 |        6.0 |
    | 2000-01-01 04:55:00 |    300.0 | 6.596271  6.595922  6.584492  6.564878  6.518468  6.449757  6.316374     6.100124 | 0.0  0.216565  0.541201  0.755304  1.070191  1.269907  1.545084  1.690111    1.784213 | 1.784213 |        6.0 |

There is no indication of an error in the water balance:

>>> from hydpy import round_
>>> round_(model.check_waterbalance(conditions))
0.0

.. _sw1d_gate_out_high_outer_waterlevel:

High outer water level
______________________

Now, we reverse the situation by setting a higher external water level:

>>> waterlevel.sequences.sim.series = 8.0

Due to the higher downstream water level and the subsequent rise of the upstream water
levels, the gate is permanently submerged:

.. integration-test::

    >>> test("sw1d_gate_out_high_outer_waterlevel")
    |                date |  timestep |                                                                       waterlevels |                                                                                   discharges |   outflow | waterlevel |
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    | 2000-01-01 00:00:00 |     300.0 |      7.0       7.0       7.0       7.0       7.0       7.0       7.0      7.15946 | 0.0        0.0        0.0        0.0        0.0        0.0        0.0        0.0   -7.973004 | -7.973004 |        8.0 |
    | 2000-01-01 00:05:00 |     300.0 |      7.0       7.0       7.0       7.0       7.0       7.0  7.058111     7.266914 | 0.0        0.0        0.0        0.0        0.0        0.0        0.0  -1.937031   -7.309727 | -7.309727 |        8.0 |
    | 2000-01-01 00:10:00 |     300.0 |      7.0       7.0       7.0       7.0       7.0   7.01392  7.142799     7.333065 | 0.0        0.0        0.0        0.0        0.0        0.0  -0.696008  -3.518954   -6.826522 | -6.826522 |        8.0 |
    | 2000-01-01 00:15:00 |     300.0 |      7.0       7.0       7.0       7.0   7.00493  7.054092  7.185874     7.391116 | 0.0        0.0        0.0        0.0        0.0  -0.164324   -2.17291  -3.608722   -6.511239 | -6.511239 |        8.0 |
    | 2000-01-01 00:20:00 |  3.192526 |      7.0       7.0       7.0  7.001167  7.030075   7.08818    7.2246     7.437656 | 0.0        0.0        0.0  -0.000002  -0.058369  -0.896545  -2.600958  -3.891835   -6.218861 | -6.218861 |        8.0 |
    | 2000-01-01 00:25:00 |  5.893766 |      7.0  7.000001  7.000853  7.011226  7.057422  7.115993  7.260948      7.47625 | 0.0        0.0  -0.000058  -0.028484  -0.531418  -1.442988  -2.833625  -4.045227   -5.974891 | -5.974891 |        8.0 |
    | 2000-01-01 00:30:00 |  8.236717 | 7.000011  7.000402  7.007351  7.027111  7.077605  7.142461  7.294472     7.508655 | 0.0  -0.000363  -0.020429  -0.237049  -1.031312  -1.704077  -3.027497  -4.144971   -5.765252 | -5.765252 |        8.0 |
    | 2000-01-01 00:35:00 |  10.27112 | 7.000339  7.003033  7.019253  7.042941  7.095021  7.167786  7.325316     7.536214 | 0.0  -0.010935  -0.142454  -0.539185  -1.330674  -1.911193  -3.177423  -4.205537   -5.583477 | -5.583477 |        8.0 |
    | 2000-01-01 00:40:00 | 12.051846 | 7.002363   7.00911  7.031828  7.057306  7.112374  7.192031  7.353473      7.55994 | 0.0  -0.067467  -0.371305  -0.790445  -1.508718  -2.087158  -3.299412  -4.237986    -5.42431 |  -5.42431 |        8.0 |
    | 2000-01-01 00:45:00 | 13.615472 |  7.00798  7.017599  7.042689  7.070705  7.129937  7.215408  7.379088     7.580575 | 0.0  -0.187242  -0.611729  -0.973763  -1.643708  -2.229134  -3.397987  -4.251832   -5.283583 | -5.283583 |        8.0 |
    | 2000-01-01 00:50:00 | 14.994033 | 7.017795  7.026957  7.052457  7.083543   7.14745  7.237968  7.402445     7.598681 | 0.0  -0.327165  -0.795068  -1.120682  -1.762541  -2.346324  -3.474331  -4.252878   -5.158173 | -5.158173 |        8.0 |
    | 2000-01-01 00:55:00 | 16.217597 | 7.030601  7.036789  7.062208  7.096125  7.164692  7.259655  7.423825     7.614706 | 0.0  -0.426875  -0.918455  -1.243488  -1.872631  -2.447354  -3.531716   -4.24439   -5.045632 | -5.045632 |        8.0 |
    | 2000-01-01 01:00:00 | 17.311513 | 7.044588   7.04743  7.072565  7.108739  7.181574  7.280398  7.443465      7.62901 | 0.0  -0.466211  -0.998235   -1.34348  -1.974161  -2.536899  -3.574052  -4.228725   -4.943928 | -4.943928 |        8.0 |
    | 2000-01-01 01:05:00 | 18.296011 |  7.05849  7.059095   7.08383  7.121602  7.198113   7.30016   7.46156     7.641881 | 0.0  -0.463395  -1.046676  -1.422168  -2.065294  -2.616601  -3.604675  -4.207828   -4.851369 | -4.851369 |        8.0 |
    | 2000-01-01 01:10:00 | 19.187169 | 7.071869  7.071655  7.096078  7.134854  7.214366  7.318948  7.478276     7.653547 | 0.0   -0.44597  -1.073966  -1.482244  -2.144876  -2.686629  -3.626047  -4.183277   -4.766561 | -4.766561 |        8.0 |
    | 2000-01-01 01:15:00 | 19.998057 | 7.084854  7.084804   7.10919  7.148564  7.230388  7.336808  7.493768     7.664189 | 0.0   -0.43284  -1.090266  -1.527327  -2.212802  -2.746883  -3.639885  -4.156259   -4.688376 | -4.688376 |        8.0 |
    | 2000-01-01 01:20:00 | 20.739591 | 7.097779  7.098267  7.122928  7.162721   7.24622  7.353806  7.508173     7.673955 | 0.0  -0.430831  -1.103976  -1.561897  -2.269763  -2.797499  -3.647406  -4.127599     -4.6159 |   -4.6159 |        8.0 |
    | 2000-01-01 01:25:00 | 21.421079 |  7.11093  7.111898  7.137045  7.177251  7.261878  7.370018  7.521623     7.682966 | 0.0   -0.43836  -1.119935  -1.590523  -2.317042  -2.838956  -3.649526  -4.097831   -4.548375 | -4.548375 |        8.0 |
    | 2000-01-01 01:30:00 | 22.050539 | 7.124448  7.125672  7.151368  7.192042  7.277351  7.385517  7.534232     7.691324 | 0.0  -0.450627   -1.13932  -1.616748  -2.356261  -2.872034  -3.646981  -4.067285   -4.485169 | -4.485169 |        8.0 |
    | 2000-01-01 01:35:00 | 22.634893 |  7.13835  7.139623  7.165812  7.206974  7.292612   7.40037  7.546104     7.699115 | 0.0  -0.463396  -1.160944  -1.642404  -2.389024  -2.897737  -3.640407  -4.036164   -4.425732 | -4.425732 |        8.0 |
    | 2000-01-01 01:40:00 | 23.180103 | 7.152584  7.153791  7.180357  7.221952  7.307628  7.414635  7.557331     7.706415 | 0.0  -0.474462  -1.182887   -1.66771  -2.416613   -2.91715  -3.630386  -4.004596   -4.369589 | -4.369589 |        8.0 |
    | 2000-01-01 01:45:00 | 23.691261 | 7.167086  7.168195  7.195007  7.236911  7.322372  7.428358  7.567987     7.713288 | 0.0  -0.483395  -1.203583  -1.691921  -2.439853  -2.931295  -3.617462  -3.972682   -4.316317 | -4.316317 |        8.0 |
    | 2000-01-01 01:50:00 | 24.172677 | 7.181806  7.182825  7.209764  7.251813  7.336827   7.44158  7.578139     7.719788 | 0.0  -0.490654  -1.222174  -1.714075  -2.459176   -2.94102  -3.602125  -3.940513   -4.265546 | -4.265546 |        8.0 |
    | 2000-01-01 01:55:00 |  24.62798 |  7.19671  7.197657  7.224617  7.266639  7.350992  7.454337   7.58784     7.725964 | 0.0  -0.496819  -1.238371  -1.733462  -2.474778  -2.946955  -3.584802  -3.908178   -4.216953 | -4.216953 |        8.0 |
    | 2000-01-01 02:00:00 | 25.060219 | 7.211777  7.212656  7.239544   7.28138  7.364875  7.466663  7.597138     7.731854 | 0.0  -0.502228  -1.252183  -1.749762  -2.486784  -2.949545  -3.565836  -3.875757   -4.170258 | -4.170258 |        8.0 |
    | 2000-01-01 02:05:00 | 25.471978 | 7.226985  7.227791  7.254522  7.296027  7.378488  7.478591  7.606073     7.737492 | 0.0  -0.506945  -1.263708  -1.762958  -2.495334  -2.949105  -3.545492  -3.843314   -4.125222 | -4.125222 |        8.0 |
    | 2000-01-01 02:10:00 | 25.865473 | 7.242312  7.243034  7.269526  7.310575  7.391846  7.490153   7.61468     7.742907 | 0.0  -0.510889  -1.273035  -1.773189  -2.500611  -2.945877  -3.523964  -3.810893    -4.08164 |  -4.08164 |        8.0 |
    | 2000-01-01 02:15:00 |  26.24263 | 7.257731  7.258359  7.284539  7.325019  7.404964  7.501379  7.622994     7.748123 | 0.0  -0.513965  -1.280229  -1.780637  -2.502826  -2.940073  -3.501398  -3.778515   -4.039334 | -4.039334 |        8.0 |
    | 2000-01-01 02:20:00 | 26.605143 | 7.273215  7.273743  7.299542  7.339354  7.417854  7.512299  7.631042     7.753163 | 0.0  -0.516139  -1.285353  -1.785469  -2.502195  -2.931892  -3.477901  -3.746182    -3.99815 |  -3.99815 |        8.0 |
    | 2000-01-01 02:25:00 |  26.95451 | 7.288738  7.289164  7.314522  7.353576  7.430532   7.52294  7.638852     7.758044 | 0.0  -0.517439  -1.288485  -1.787829  -2.498926  -2.921517  -3.453555  -3.713883   -3.957951 | -3.957951 |        8.0 |
    | 2000-01-01 02:30:00 | 27.292068 | 7.304276    7.3046  7.329466  7.367683   7.44301  7.533326  7.646447     7.762784 | 0.0  -0.517933  -1.289728  -1.787853  -2.493205  -2.909119  -3.428427  -3.681599   -3.918614 | -3.918614 |        8.0 |
    | 2000-01-01 02:35:00 |  27.61901 | 7.319807   7.32003   7.34436  7.381673  7.455299  7.543481  7.653849     7.767399 | 0.0  -0.517695  -1.289196  -1.785674  -2.485206  -2.894852  -3.402569  -3.649305   -3.880026 | -3.880026 |        8.0 |
    | 2000-01-01 02:40:00 | 27.936403 | 7.335311  7.335435  7.359193  7.395546  7.467412  7.553424  7.661078     7.771901 | 0.0  -0.516793  -1.287016  -1.781436  -2.475089  -2.878854  -3.376023  -3.616974   -3.842085 | -3.842085 |        8.0 |
    | 2000-01-01 02:45:00 | 28.245206 | 7.350769  7.350795  7.373952  7.409301  7.479359  7.563175  7.668151     7.776303 | 0.0  -0.515277  -1.283307  -1.775282  -2.463007  -2.861248  -3.348823  -3.584579   -3.804697 | -3.804697 |        8.0 |
    | 2000-01-01 02:50:00 |  28.54628 | 7.366165  7.366095  7.388627  7.422936  7.491151  7.572752  7.675084     7.780617 | 0.0  -0.513191  -1.278186  -1.767357  -2.449105  -2.842148  -3.320995   -3.55209   -3.767774 | -3.767774 |        8.0 |
    | 2000-01-01 02:55:00 | 28.840399 | 7.381482  7.381319  7.403209   7.43645  7.502795   7.58217  7.681891     7.784852 | 0.0  -0.510576  -1.271764  -1.757802   -2.43352  -2.821658  -3.292562  -3.519479   -3.731236 | -3.731236 |        8.0 |
    | 2000-01-01 03:00:00 | 29.128262 | 7.396706  7.396452  7.417687  7.449843    7.5143  7.591444  7.688586     7.789018 | 0.0  -0.507472  -1.264145  -1.746749  -2.416381  -2.799875  -3.263542  -3.486716   -3.695007 | -3.695007 |        8.0 |
    | 2000-01-01 03:05:00 | 29.410495 | 7.411824  7.411483  7.432053  7.463113  7.525672  7.600585  7.695181     7.793123 | 0.0  -0.503919  -1.255428  -1.734321   -2.39781  -2.776889  -3.233951  -3.453775   -3.659016 | -3.659016 |        8.0 |
    | 2000-01-01 03:10:00 | 29.687661 | 7.426823  7.426398  7.446301  7.476258  7.536918  7.609605  7.701686     7.797174 | 0.0  -0.499959  -1.245712  -1.720638  -2.377922  -2.752785  -3.203805   -3.42063   -3.623198 | -3.623198 |        8.0 |
    | 2000-01-01 03:15:00 | 29.960264 | 7.441692  7.441187  7.460423  7.489279  7.548042  7.618515   7.70811     7.801179 | 0.0  -0.495632  -1.235088  -1.705811  -2.356823  -2.727642  -3.173115  -3.387256   -3.587492 | -3.587492 |        8.0 |
    | 2000-01-01 03:20:00 | 30.228752 | 7.456421   7.45584  7.474412  7.502172   7.55905  7.627322  7.714462     7.805143 | 0.0  -0.490974  -1.223643  -1.689946  -2.334614  -2.701534  -3.141896   -3.35363    -3.55184 |  -3.55184 |        8.0 |
    | 2000-01-01 03:25:00 | 30.493525 | 7.471002  7.470349  7.488262  7.514937  7.569944  7.636035  7.720749     7.809072 | 0.0  -0.486019  -1.211461  -1.673143  -2.311389   -2.67453  -3.110159  -3.319731    -3.51619 |  -3.51619 |        8.0 |
    | 2000-01-01 03:30:00 | 30.754935 | 7.485426  7.484705  7.501969  7.527572  7.580728  7.644659  7.726978     7.812971 | 0.0  -0.480799  -1.198619  -1.655496  -2.287237  -2.646696  -3.077917  -3.285542    -3.48049 |  -3.48049 |        8.0 |
    | 2000-01-01 03:35:00 |  31.01329 | 7.499686  7.498902  7.515526  7.540075  7.591404  7.653201  7.733154     7.816844 | 0.0  -0.475344  -1.185189  -1.637094  -2.262242  -2.618094  -3.045181  -3.251043   -3.444697 | -3.444697 |        8.0 |
    | 2000-01-01 03:40:00 | 31.268859 | 7.513776  7.512933  7.528929  7.552444  7.601973  7.661664  7.739281     7.820695 | 0.0  -0.469682  -1.171239  -1.618018  -2.236482  -2.588781  -3.011964  -3.216221   -3.408766 | -3.408766 |        8.0 |
    | 2000-01-01 03:45:00 | 31.521872 | 7.527691  7.526793  7.542175  7.564678  7.612436  7.670054  7.745365     7.824527 | 0.0  -0.463836   -1.15683  -1.598346   -2.21003  -2.558813  -2.978276  -3.181062   -3.372659 | -3.372659 |        8.0 |
    | 2000-01-01 03:50:00 | 31.772527 | 7.541426  7.540477  7.555259  7.576774  7.622795  7.678372  7.751408     7.828343 | 0.0  -0.457832  -1.142019  -1.578146  -2.182954  -2.528241  -2.944132  -3.145555    -3.33634 |  -3.33634 |        8.0 |
    | 2000-01-01 03:55:00 | 32.020987 | 7.554977   7.55398  7.568177   7.58873  7.633049   7.68662  7.757412     7.832145 | 0.0  -0.451691   -1.12686  -1.557484  -2.155318  -2.497115  -2.909543   -3.10969   -3.299776 | -3.299776 |        8.0 |
    | 2000-01-01 04:00:00 | 32.267386 |  7.56834    7.5673  7.580928  7.600546  7.643198  7.694801   7.76338     7.835934 | 0.0  -0.445432  -1.111399  -1.536419  -2.127181  -2.465481  -2.874523   -3.07346   -3.262937 | -3.262937 |        8.0 |
    | 2000-01-01 04:05:00 |  32.51183 | 7.581512  7.580432  7.593508  7.612218  7.653241  7.702915  7.769313     7.839713 | 0.0  -0.439072  -1.095681  -1.515005  -2.098597  -2.433381  -2.839083  -3.036858   -3.225797 | -3.225797 |        8.0 |
    | 2000-01-01 04:10:00 | 32.754401 | 7.594491  7.593374  7.605914  7.623744  7.663178  7.710963  7.775213     7.843482 | 0.0  -0.432628  -1.079744  -1.493292  -2.069617  -2.400856  -2.803238   -2.99988    -3.18833 |  -3.18833 |        8.0 |
    | 2000-01-01 04:15:00 | 32.995155 | 7.607274  7.606124  7.618145  7.635123  7.673008  7.718944  7.781078     7.847242 | 0.0  -0.426114  -1.063624  -1.471323  -2.040287  -2.367943  -2.767001  -2.962523   -3.150516 | -3.150516 |        8.0 |
    | 2000-01-01 04:20:00 | 33.234129 | 7.619861  7.618681  7.630199  7.646354  7.682729  7.726858   7.78691     7.850993 | 0.0  -0.419542  -1.047352  -1.449139   -2.01065  -2.334678  -2.730384  -2.924786   -3.112336 | -3.112336 |        8.0 |
    | 2000-01-01 04:25:00 | 33.471339 | 7.632248  7.631041  7.642073  7.657433  7.692339  7.734704  7.792708     7.854735 | 0.0  -0.412924  -1.030956  -1.426776  -1.980742  -2.301093  -2.693401  -2.886668   -3.073774 | -3.073774 |        8.0 |
    | 2000-01-01 04:30:00 | 33.706784 | 7.644436  7.643205  7.653767   7.66836  7.701838  7.742481  7.798472     7.858468 | 0.0  -0.406269  -1.014462  -1.404265    -1.9506  -2.267217  -2.656065   -2.84817   -3.034815 | -3.034815 |        8.0 |
    | 2000-01-01 04:35:00 | 33.940446 | 7.656424  7.655171   7.66528  7.679132  7.711222  7.750187  7.804199     7.862191 | 0.0  -0.399587  -0.997891  -1.381634  -1.920255  -2.233079  -2.618388  -2.809295   -2.995449 | -2.995449 |        8.0 |
    | 2000-01-01 04:40:00 | 34.172296 | 7.668211  7.666939  7.676609  7.689749  7.720491  7.757821  7.809889     7.865903 | 0.0  -0.392885  -0.981262  -1.358908  -1.889735  -2.198703  -2.580384  -2.770045   -2.955665 | -2.955665 |        8.0 |
    | 2000-01-01 04:45:00 | 34.402289 | 7.679796  7.678507  7.687755  7.700208  7.729643   7.76538  7.815539     7.869604 | 0.0  -0.386168  -0.964591  -1.336109  -1.859065  -2.164111  -2.542064  -2.730424   -2.915456 | -2.915456 |        8.0 |
    | 2000-01-01 04:50:00 |  34.63037 | 7.691179  7.689876  7.698715  7.710508  7.738675  7.772862  7.821149     7.873291 | 0.0  -0.379444  -0.947893  -1.313256  -1.828266  -2.129326  -2.503441  -2.690438   -2.874816 | -2.874816 |        8.0 |
    | 2000-01-01 04:55:00 | 34.856477 |  7.70236  7.701045  7.709491  7.720648  7.747585  7.780265  7.826716     7.876964 | 0.0  -0.372716  -0.931178  -1.290363  -1.797359  -2.094364  -2.464526  -2.650091   -2.833743 | -2.833743 |        8.0 |

There is no indication of an error in the water balance:

>>> round_(model.check_waterbalance(conditions))
0.0

.. _sw1d_gate_out_rising_outer_waterlevel:

Rising outer water level
________________________

Next, we combine both previous examples by letting the external water level rise from
six to eight meters:

>>> import numpy
>>> waterlevel.sequences.sim.series = numpy.linspace(6.0, 8.0, len(pub.timegrids.init))

The resulting water level trajectories are plausible but indicate some numerical
inaccuracies after one and a half and two and a half hours:

.. integration-test::

    >>> test("sw1d_gate_out_rising_outer_waterlevel")
    |                date |  timestep |                                                                       waterlevels |                                                                                   discharges |   outflow | waterlevel |
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    | 2000-01-01 00:00:00 |     300.0 |      7.0       7.0       7.0       7.0       7.0       7.0       7.0      6.84054 | 0.0        0.0        0.0        0.0        0.0        0.0        0.0        0.0    7.973004 |  7.973004 |        6.0 |
    | 2000-01-01 00:05:00 |     300.0 |      7.0       7.0       7.0       7.0       7.0       7.0  6.945481     6.739664 | 0.0        0.0        0.0        0.0        0.0        0.0        0.0   1.817298    6.861105 |  6.861105 |   6.033898 |
    | 2000-01-01 00:10:00 |     300.0 |      7.0       7.0       7.0       7.0       7.0  6.987374  6.874902     6.677026 | 0.0        0.0        0.0        0.0        0.0        0.0     0.6313   2.983932     6.11584 |   6.11584 |   6.067797 |
    | 2000-01-01 00:15:00 |     300.0 |      7.0       7.0       7.0       7.0  6.995552  6.954451  6.844252     6.621317 | 0.0        0.0        0.0        0.0        0.0   0.148258   1.794393   2.816057    5.601501 |  5.601501 |   6.101695 |
    | 2000-01-01 00:20:00 |     300.0 |      7.0       7.0       7.0  6.998954  6.974599   6.92887  6.817662     6.577511 | 0.0        0.0        0.0        0.0   0.052289   0.750743   2.029809   2.916157    5.106436 |  5.106436 |   6.135593 |
    | 2000-01-01 00:25:00 |     300.0 |      7.0       7.0  6.999631   6.99127  6.952533  6.909543  6.792908     6.542714 | 0.0        0.0        0.0   0.012308   0.396536   1.132069   2.098417   2.923528    4.663375 |  4.663375 |   6.169492 |
    | 2000-01-01 00:30:00 |     300.0 |      7.0  6.999913  6.995341  6.978119  6.938004  6.892393  6.770503     6.515557 | 0.0        0.0   0.004346   0.147326   0.804842   1.289135   2.146616   2.893478    4.251335 |  4.251335 |    6.20339 |
    | 2000-01-01 00:35:00 |     300.0 | 6.999969  6.998496  6.985885  6.964922  6.927511  6.876869  6.750307     6.495292 | 0.0   0.001023   0.071879   0.387088   1.046948   1.396696    2.17293   2.846119    3.859357 |  3.859357 |   6.237288 |
    | 2000-01-01 00:40:00 |     300.0 | 6.999209  6.994201  6.974784  6.954091  6.917418  6.862864  6.732421     6.481371 | 0.0    0.02534   0.240093   0.610115    1.15166   1.488093   2.188319   2.784518    3.480605 |  3.480605 |   6.271186 |
    | 2000-01-01 00:45:00 |     300.0 | 6.996132   6.98712  6.965764  6.945075  6.907159  6.849939  6.716933     6.473436 | 0.0   0.102556   0.456578   0.757273   1.208074   1.550065   2.196336   2.712586    3.109293 |  3.109293 |   6.305085 |
    | 2000-01-01 00:50:00 |     300.0 | 6.989293  6.979049  6.959036  6.937133  6.897142  6.837793  6.703795     6.471261 | 0.0   0.227979    0.63155   0.855797   1.252887   1.586761   2.194043    2.63198    2.740733 |  2.740733 |   6.338983 |
    | 2000-01-01 00:55:00 |     300.0 | 6.978889  6.971279  6.953118   6.92991  6.887671  6.826374  6.692945     6.474686 | 0.0   0.346804   0.735304   0.932574   1.293726   1.609441   2.180401   2.542072    2.370859 |  2.370859 |   6.372881 |
    | 2000-01-01 01:00:00 |     300.0 | 6.966699  6.963652   6.94702  6.923109  6.878838  6.815754  6.684396     6.483603 | 0.0   0.406347   0.787697   0.990953   1.331002    1.62545   2.156451    2.44142    1.995576 |  1.995576 |    6.40678 |
    | 2000-01-01 01:05:00 |     300.0 | 6.954684  6.955493  6.940398  6.916441  6.870592  6.806036   6.67825     6.497963 | 0.0   0.400483   0.808456    1.02919   1.362593   1.637454   2.123333   2.328187    1.610174 |  1.610174 |   6.440678 |
    | 2000-01-01 01:10:00 |     300.0 | 6.943955  6.946535  6.933106  6.909691  6.862821  6.797312  6.674694     6.517798 | 0.0   0.357629   0.805508   1.048588   1.386098   1.645128   2.081342   2.199892    1.208124 |  1.208124 |   6.474576 |
    | 2000-01-01 01:15:00 |     300.0 | 6.934646  6.937048  6.925099  6.902717  6.855422  6.789656  6.673998     6.543458 | 0.0   0.310304   0.784631   1.051546   1.400246   1.646871   2.029672   2.052866    0.769864 |  0.769864 |   6.508475 |
    | 2000-01-01 01:20:00 |     300.0 | 6.926297  6.927522  6.916515  6.895438  6.848332  6.783149  6.676593     6.575802 | 0.0   0.278292   0.754596   1.040702   1.404647   1.640971   1.966336   1.879842    0.262668 |  0.262668 |   6.542373 |
    | 2000-01-01 01:25:00 |     300.0 | 6.918317  6.918344  6.907665  6.887851  6.841534  6.777915  6.683195     6.612608 | 0.0   0.266014   0.724929   1.019953   1.399321    1.62592    1.88762   1.667543   -0.172754 | -0.172754 |   6.576271 |
    | 2000-01-01 01:30:00 |     300.0 | 6.910295  6.909652   6.89889  6.880047  6.835072  6.774179  6.693317     6.633725 | 0.0   0.267389   0.702003   0.994507    1.38471   1.600133   1.786943   1.449562    0.393689 |  0.393689 |   6.610169 |
    | 2000-01-01 01:35:00 |     300.0 | 6.902101  6.901369  6.890426  6.872201  6.829079  6.772076  6.702954     6.676849 | 0.0   0.273128   0.687249   0.969378   1.361688   1.561446   1.666573   1.345331   -0.810847 | -0.810847 |   6.644068 |
    | 2000-01-01 01:40:00 |     300.0 | 6.893808  6.893334  6.882346  6.864529  6.823734   6.77112  6.716104     6.704554 | 0.0   0.276444   0.678194   0.947509   1.331095   1.509275   1.557091   1.118742   -0.266523 | -0.266523 |   6.677966 |
    | 2000-01-01 01:45:00 |     300.0 | 6.885558  6.885415  6.874611  6.857233  6.819045  6.771726   6.73195     6.736017 | 0.0   0.275001   0.670991   0.928845   1.293656    1.44995    1.41965   0.891469   -0.681702 | -0.681702 |   6.711864 |
    | 2000-01-01 01:50:00 |     300.0 | 6.877465  6.877559  6.867156  6.850424   6.81522  6.774147  6.748758     6.765711 | 0.0   0.269762   0.662526   0.911005   1.251442   1.378919   1.257871   0.697613   -0.787083 | -0.787083 |   6.745763 |
    | 2000-01-01 01:55:00 |     300.0 | 6.869581  6.869793  6.859951  6.844176  6.812509  6.778359  6.766601     6.794318 | 0.0   0.262796   0.651129   0.891296   1.203713   1.294082   1.083472   0.488677   -0.941683 | -0.941683 |   6.779661 |
    | 2000-01-01 02:00:00 |     300.0 | 6.861913  6.862178  6.853022  6.838559  6.811067  6.784442  6.785369     6.821768 | 0.0   0.255625   0.636376   0.867356   1.148185   1.196279   0.892135   0.266551   -1.105946 | -1.105946 |   6.813559 |
    | 2000-01-01 02:05:00 |     300.0 | 6.854453  6.854785  6.846448  6.833652  6.811026  6.792529  6.804996     6.847837 | 0.0   0.248651   0.618292   0.837423   1.082761   1.084121   0.679757   0.025534   -1.277901 | -1.277901 |   6.847458 |
    | 2000-01-01 02:10:00 |     300.0 | 6.847212  6.847679  6.840336  6.829557   6.81255  6.802819   6.82544     6.872199 | 0.0   0.241361   0.596648   0.800385   1.005168   0.954351   0.439869  -0.241613   -1.459709 | -1.459709 |   6.881356 |
    | 2000-01-01 02:15:00 |     300.0 | 6.840228  6.840921  6.834798  6.826414  6.815879  6.814748  6.856706     6.888544 | 0.0   0.232812   0.570729   0.755305   0.912451   0.801506   0.205054  -0.837128   -1.654378 | -1.654378 |   6.915254 |
    | 2000-01-01 02:20:00 |     300.0 | 6.833566  6.834574  6.829957  6.824425  6.821052  6.829702  6.882839      6.90798 | 0.0   0.222051   0.539373   0.700771   0.800204   0.627764  -0.119935  -0.991062   -1.962858 | -1.962858 |   6.949153 |
    | 2000-01-01 02:25:00 |     300.0 | 6.827317   6.82872  6.825959   6.82381  6.828145  6.854565  6.889123      6.93119 | 0.0   0.208303   0.501006   0.634261   0.665001   0.428576  -0.814578  -1.024038   -2.184529 | -2.184529 |   6.983051 |
    | 2000-01-01 02:30:00 |     300.0 | 6.821589  6.823469  6.822991  6.824825  6.837678  6.877722  6.897895      6.95256 | 0.0   0.190928    0.45347   0.552397   0.501643   0.183862  -0.973984  -1.266366   -2.334871 | -2.334871 |   7.016949 |
    | 2000-01-01 02:35:00 |     300.0 | 6.816514  6.818975  6.821295  6.827905  6.850641  6.893422  6.915092     6.972673 | 0.0   0.169171   0.393878   0.450405   0.296409  -0.135698  -0.920697  -1.493951   -2.499605 | -2.499605 |   7.050847 |
    | 2000-01-01 02:40:00 |     300.0 | 6.812258  6.815449  6.821257  6.833381  6.872315  6.898461  6.935515     6.993867 | 0.0   0.141863   0.318174   0.319457   0.045692  -0.676753  -0.928698  -1.609451   -2.669145 | -2.669145 |   7.084746 |
    | 2000-01-01 02:45:00 |     300.0 | 6.809045  6.813201  6.823378  6.842075  6.887484   6.90525  6.951872     7.016669 | 0.0   0.107097   0.219503   0.148805  -0.285901   -0.79155  -1.131023  -1.676274    -2.81637 |  -2.81637 |   7.118644 |
    | 2000-01-01 02:50:00 |     300.0 | 6.807199  6.812691  6.826909  6.856775  6.888834  6.915397  6.965943     7.039706 | 0.0   0.061534   0.087023  -0.030675  -0.765673  -0.810685  -1.318048  -1.787065   -2.938932 | -2.938932 |   7.152542 |
    | 2000-01-01 02:55:00 |     300.0 | 6.807216  6.814118  6.837639  6.865737  6.891251  6.924953   6.98065     7.062263 | 0.0  -0.000548  -0.071872   -0.42955  -0.877673  -0.958229  -1.436031  -1.926278   -3.054135 | -3.054135 |   7.186441 |
    | 2000-01-01 03:00:00 |     300.0 |  6.80965  6.819433  6.847287   6.87071  6.897017  6.933735   6.99588     7.084541 | 0.0  -0.081141  -0.346902  -0.668517  -0.917142  -1.109343  -1.548404  -2.056071   -3.169966 | -3.169966 |   7.220339 |
    | 2000-01-01 03:05:00 |     300.0 | 6.815638  6.827402  6.852758  6.874612  6.904119  6.942828  7.011123      7.10673 | 0.0  -0.199603  -0.598051  -0.780389  -0.975523  -1.212249  -1.666897  -2.174977   -3.284415 | -3.284415 |   7.254237 |
    | 2000-01-01 03:10:00 |     300.0 | 6.825471   6.83554  6.856167  6.878623  6.911231  6.952666  7.026477     7.128853 | 0.0  -0.327765  -0.734678  -0.848335  -1.048885  -1.285946   -1.77789  -2.289711   -3.395842 | -3.395842 |   7.288136 |
    | 2000-01-01 03:15:00 |     300.0 | 6.837714  6.842948  6.859935  6.882951  6.918243  6.963127  7.042177     7.150927 | 0.0  -0.408107  -0.778491  -0.904067  -1.120472  -1.354217  -1.877256  -2.400583   -3.504327 | -3.504327 |   7.322034 |
    | 2000-01-01 03:20:00 |     300.0 | 6.850188  6.850224  6.864896  6.887747  6.925441  6.974024  7.058275     7.173004 | 0.0  -0.415792  -0.779622  -0.944997  -1.184796  -1.424738   -1.96956  -2.506139   -3.609974 | -3.609974 |   7.355932 |
    | 2000-01-01 03:25:00 |     300.0 | 6.861299  6.858105  6.871017  6.893214  6.933075  6.985279  7.074709      7.19512 | 0.0  -0.370363  -0.764406  -0.968451  -1.241776  -1.496218  -2.058983  -2.606797   -3.712599 | -3.712599 |   7.389831 |
    | 2000-01-01 03:30:00 |     300.0 | 6.870538  6.866749  6.878153  6.899495  6.941289  6.996899  7.091421     7.217284 | 0.0  -0.307954  -0.740149  -0.978023  -1.292064  -1.565863   -2.14689  -2.703947   -3.812136 | -3.812136 |   7.423729 |
    | 2000-01-01 03:35:00 |     300.0 | 6.878281  6.875802  6.886191   6.90665  6.950154  7.008923  7.108385     7.239487 | 0.0  -0.258102   -0.71074  -0.978664  -1.336445  -1.631971  -2.233128  -2.798616    -3.90875 |  -3.90875 |   7.457627 |
    | 2000-01-01 03:40:00 |     300.0 | 6.885319  6.884771  6.894932  6.914679    6.9597  7.021387  7.125603     7.261717 | 0.0  -0.234595  -0.683071  -0.974432  -1.375875  -1.694065  -2.317284  -2.891203   -4.002725 | -4.002725 |   7.491525 |
    | 2000-01-01 03:45:00 |     300.0 | 6.892392  6.893357  6.904061   6.92352  6.969929  7.034321  7.143082     7.283968 | 0.0  -0.235791  -0.665093  -0.969412  -1.411439  -1.752409  -2.399132  -2.981765   -4.094328 | -4.094328 |   7.525424 |
    | 2000-01-01 03:50:00 |     300.0 | 6.899919  6.901569  6.913268  6.933043  6.980821  7.047743   7.16083     7.306238 | 0.0    -0.2509  -0.661501  -0.968373  -1.444528  -1.807581  -2.478657  -3.070272   -4.183767 | -4.183767 |   7.559322 |
    | 2000-01-01 03:55:00 |     300.0 | 6.907971  6.909633  6.922389   6.94307   6.99232  7.061656  7.178853     7.328528 | 0.0  -0.268386  -0.671583  -0.975644  -1.477001  -1.860322  -2.555972  -3.156722   -4.271196 | -4.271196 |    7.59322 |
    | 2000-01-01 04:00:00 |  1.260002 | 6.916422   6.91781  6.931472  6.953419  7.004348  7.076043  7.197161     7.350823 | 0.0  -0.281717  -0.690538  -0.993285  -1.510732  -1.911645  -2.630996  -3.241284   -4.356033 | -4.356033 |   7.627119 |
    | 2000-01-01 04:05:00 |  2.579174 | 6.925351  6.926071  6.940979  6.963824  7.016985  7.090823  7.215478     7.373234 | 0.0  -0.297605  -0.710664  -1.027571  -1.547814  -1.969055  -2.708056  -3.318602   -4.439177 | -4.439177 |   7.661017 |
    | 2000-01-01 04:10:00 |  3.884353 | 6.934436  6.934803  6.950541  6.974521  7.029803  7.105991  7.234165     7.395601 | 0.0  -0.302847  -0.739462  -1.058191  -1.593041  -2.020315  -2.778742  -3.401662   -4.519994 | -4.519994 |   7.694915 |
    | 2000-01-01 04:15:00 |  5.185633 | 6.943637  6.943996  6.960288  6.985471  7.042812  7.121525  7.253156     7.417954 | 0.0  -0.306693   -0.76635   -1.09126  -1.638752  -2.072389  -2.849054   -3.48206   -4.599708 | -4.599708 |   7.728814 |
    | 2000-01-01 04:20:00 |   6.48105 | 6.953031  6.953531  6.970362  6.996646   7.05607  7.137384  7.272381     7.440314 | 0.0   -0.31313  -0.789851  -1.125636   -1.68443  -2.126363  -2.919337  -3.560175   -4.678164 | -4.678164 |   7.762712 |
    | 2000-01-01 04:25:00 |  7.768514 | 6.962693  6.963334  6.980773  7.008075    7.0696   7.15354  7.291799     7.462684 | 0.0  -0.322077  -0.812217  -1.159245  -1.730677  -2.181671  -2.989454  -3.636741   -4.755287 | -4.755287 |    7.79661 |
    | 2000-01-01 04:30:00 |  9.046615 |  6.97266  6.973389  6.991478  7.019787  7.083411   7.16997  7.311386     7.485064 | 0.0  -0.332233  -0.834992  -1.191824  -1.777426  -2.237799  -3.059281  -3.712157   -4.831117 | -4.831117 |   7.830508 |
    | 2000-01-01 04:35:00 | 10.314413 | 6.982936  6.983706  7.002449  7.031794  7.097509  7.186657  7.331122     7.507446 | 0.0  -0.342545  -0.858392  -1.224115  -1.824453  -2.294378  -3.128748  -3.786611   -4.905731 | -4.905731 |   7.864407 |
    | 2000-01-01 04:40:00 | 11.571248 | 6.993512  6.994298  7.013688  7.044094  7.111892   7.20359  7.350993     7.529826 | 0.0  -0.352521  -0.882116  -1.256727   -1.87171  -2.351158  -3.197807  -3.860199   -4.979218 | -4.979218 |   7.898305 |
    | 2000-01-01 04:45:00 |  12.81665 | 7.004375  7.005174  7.025204  7.056682  7.126556  7.220758   7.37099       7.5522 | 0.0  -0.362103   -0.90593  -1.289823  -1.919244  -2.408012  -3.266422  -3.932975    -5.05166 |  -5.05166 |   7.932203 |
    | 2000-01-01 04:50:00 | 14.050283 | 7.015519  7.016341   7.03701  7.069557   7.14149  7.238152  7.391102     7.574563 | 0.0  -0.371458  -0.929779  -1.323304  -1.967064  -2.464895  -3.334572  -4.004973    -5.12313 |  -5.12313 |   7.966102 |
    | 2000-01-01 04:55:00 | 15.271911 | 7.026943  7.027799   7.04911  7.082719   7.15669  7.255761  7.411321     7.596913 | 0.0  -0.380801   -0.95371  -1.357032  -2.015126  -2.521792   -3.40225  -4.076222   -5.193693 | -5.193693 |        8.0 |

There is no indication of an error in the water balance:

>>> round_(model.check_waterbalance(conditions))
0.0

.. _sw1d_gate_out_higher_precision:

Higher precision
________________

One possible solution is increasing numerical precision (like in the
:ref:`sw1d_channel_higher_precision` example), eventually accompanied by reducing
numerical diffusion (like in the :ref:`sw1d_channel_no_additional_diffusion` example):

>>> for routingmodel in model.routingmodels[1:-1]:
...     routingmodel.parameters.control.timestepfactor(0.1)
...     routingmodel.parameters.control.diffusionfactor(0.0)

After this change, all trajectories have a smooth appearance:

.. integration-test::

    >>> test("sw1d_gate_out_higher_precision")
    |                date |  timestep |                                                                       waterlevels |                                                                                   discharges |   outflow | waterlevel |
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    | 2000-01-01 00:00:00 | 29.085815 |      7.0       7.0       7.0       7.0  6.999999   6.99991    6.9918     6.854698 | 0.0        0.0        0.0        0.0        0.0    0.00002   0.004525   0.277863    7.542971 |  7.542971 |        6.0 |
    | 2000-01-01 00:05:00 | 29.085815 |      7.0       7.0       7.0  6.999999  6.999909  6.997342  6.950328     6.752126 | 0.0        0.0        0.0        0.0   0.000057   0.003053   0.131468   1.513864    6.642449 |  6.642449 |   6.033898 |
    | 2000-01-01 00:10:00 | 29.085815 |      7.0       7.0  6.999999   6.99996  6.998725  6.985382  6.894698     6.682254 | 0.0        0.0   0.000001   0.000039   0.002002    0.04147   0.639471     2.4938      5.9874 |    5.9874 |   6.067797 |
    | 2000-01-01 00:15:00 | 29.085813 |      7.0  6.999999  6.999976   6.99957  6.993281  6.961969  6.852337     6.628468 | 0.0   0.000001   0.000029   0.000779   0.020247   0.201736   1.372385   2.784436    5.473738 |  5.473738 |   6.101695 |
    | 2000-01-01 00:20:00 | 29.085751 |      7.0  6.999991  6.999787   6.99772  6.980391  6.935005  6.823652     6.584729 | 0.0   0.000013   0.000436   0.006764   0.099272   0.528941   1.877143   2.833292    5.020232 |  5.020232 |   6.135593 |
    | 2000-01-01 00:25:00 | 29.085097 | 6.999995  6.999925  6.998882  6.992498  6.961846   6.91187  6.800189     6.549715 | 0.0    0.00016   0.003444    0.03359    0.29469   0.912842    2.06958   2.851677     4.60239 |   4.60239 |   6.169492 |
    | 2000-01-01 00:30:00 | 29.080946 | 6.999959  6.999604  6.996099  6.982767  6.943737  6.893527  6.778129      6.52252 | 0.0   0.001182   0.017251   0.110013   0.596559   1.200191   2.117342   2.852666    4.212438 |  4.212438 |    6.20339 |
    | 2000-01-01 00:35:00 | 29.063001 | 6.999781  6.998514  6.990173  6.969923  6.929938  6.878036  6.757369     6.502195 | 0.0   0.005954   0.060444   0.257989   0.900223   1.360211   2.134766   2.826781    3.843036 |  3.843036 |   6.237288 |
    | 2000-01-01 00:40:00 | 29.006184 | 6.999123  6.995812   6.98109  6.957007  6.919606  6.864003  6.738567      6.48802 | 0.0   0.021921   0.157032   0.459811   1.105571   1.449954   2.151581   2.778309    3.487057 |  3.487057 |   6.271186 |
    | 2000-01-01 00:45:00 | 28.867863 | 6.997275   6.99075  6.970737  6.946139  6.910251  6.850992   6.72208     6.479543 | 0.0   0.061619   0.314704   0.659775   1.203196   1.515027   2.165592   2.715153    3.138959 |  3.138959 |   6.305085 |
    | 2000-01-01 00:50:00 | 28.599206 | 6.993195  6.983393  6.961515  6.937512  6.900555  6.838868  6.707977      6.47649 | 0.0   0.135987   0.503827   0.811229   1.242579   1.565777   2.171967   2.642096    2.794773 |  2.794773 |   6.338983 |
    | 2000-01-01 00:55:00 |  28.16875 | 6.985983  6.974788  6.954386  6.930294   6.89064   6.82749  6.696217     6.478671 | 0.0    0.24041   0.670676   0.908321   1.269215   1.599729   2.168636   2.560633    2.451569 |  2.451569 |   6.372881 |
    | 2000-01-01 01:00:00 | 27.581018 | 6.975572  6.966169   6.94861  6.923679  6.881118  6.816765  6.686754     6.485938 | 0.0   0.347037   0.777989   0.970511   1.301268    1.61865   2.154913   2.470343    2.107022 |  2.107022 |    6.40678 |
    | 2000-01-01 01:05:00 | 26.876323 | 6.963027   6.95803  6.942919  6.917231  6.872365   6.80673  6.679582      6.49815 | 0.0   0.418143   0.825097   1.014817   1.337221    1.62898   2.130721   2.369762    1.759124 |  1.759124 |   6.440678 |
    | 2000-01-01 01:10:00 | 26.114166 | 6.950085      6.95  6.936518  6.910759  6.864377  6.797524  6.674774      6.51517 | 0.0    0.43141   0.832887   1.046262   1.369856   1.636153   2.096463   2.256732    1.405745 |  1.405745 |   6.474576 |
    | 2000-01-01 01:15:00 | 25.351845 | 6.938309  6.941428  6.929248  6.904145  6.856953  6.789304   6.67251     6.537102 | 0.0   0.392535   0.821139   1.063462   1.394142   1.641583   2.052586   2.128056    1.031462 |  1.031462 |   6.508475 |
    | 2000-01-01 01:20:00 | 24.628915 | 6.928474  6.932001  6.921255   6.89729  6.849902  6.782198  6.673183     6.564207 | 0.0   0.327824   0.799196   1.065638   1.408419   1.643469   1.998755   1.976344    0.621112 |  0.621112 |   6.542373 |
    | 2000-01-01 01:25:00 | 23.961426 | 6.920424  6.921979  6.912698  6.890126  6.843119  6.776316  6.677075      6.59374 | 0.0   0.268333   0.769418   1.054632   1.412841   1.638927   1.933044   1.803311    0.326658 |  0.326658 |   6.576271 |
    | 2000-01-01 01:30:00 | 23.344012 |  6.91334  6.912017  6.903719  6.882638  6.836595  6.771762  6.684157     6.624163 | 0.0   0.236152   0.734258   1.033571   1.407955   1.625428   1.853092   1.617006    0.095841 |  0.095841 |   6.610169 |
    | 2000-01-01 01:35:00 | 22.757171 | 6.906239  6.902756  6.894541  6.874869  6.830383  6.768641  6.694183     6.654419 | 0.0   0.236703   0.699764   1.005696   1.394138   1.601223   1.757279   1.423081   -0.089707 | -0.089707 |   6.644068 |
    | 2000-01-01 01:40:00 |  22.17768 | 6.898471  6.894461  6.885515  6.866927  6.824574   6.76705  6.706818     6.685374 | 0.0   0.258912   0.673647   0.974504   1.371582   1.565212   1.644751   1.223583   -0.324198 | -0.324198 |   6.677966 |
    | 2000-01-01 01:45:00 | 21.588807 | 6.889963  6.886923  6.877008  6.858998   6.81929  6.767091  6.721872     6.716646 | 0.0    0.28361   0.660528   0.944093   1.340539   1.516659    1.51464   1.012851    -0.55071 |  -0.55071 |   6.711864 |
    | 2000-01-01 01:50:00 | 20.985887 | 6.881103  6.879657  6.869215  6.851335   6.81469  6.768891  6.739217     6.748063 | 0.0    0.29532   0.658625   0.918388   1.301564   1.454896   1.364896   0.786736   -0.784131 | -0.784131 |   6.745763 |
    | 2000-01-01 01:55:00 | 20.375218 | 6.872417  6.872233  6.862059   6.84421  6.810983  6.772632  6.758776     6.778393 | 0.0   0.289544   0.660705   0.899247   1.255471   1.379032   1.191973       0.54    -0.97651 |  -0.97651 |   6.779661 |
    | 2000-01-01 02:00:00 | 19.768262 |  6.86426    6.8645   6.85527  6.837851   6.80844  6.778576  6.780408     6.806585 | 0.0     0.2719   0.658567   0.884871   1.202862   1.287653   0.990427   0.269348   -1.140255 | -1.140255 |   6.813559 |
    | 2000-01-01 02:05:00 |   19.1752 | 6.856697  6.856593  6.848593  6.832386  6.807387   6.78709  6.803804     6.832581 | 0.0   0.252112   0.647475   0.870046   1.143287   1.178374   0.752685   -0.02719   -1.327006 | -1.327006 |   6.847458 |
    | 2000-01-01 02:10:00 | 18.601071 | 6.849561    6.8488  6.841967  6.827865  6.808206  6.798655   6.82787     6.856556 | 0.0   0.237859   0.627479   0.848342   1.074408     1.0471   0.468855  -0.333326   -1.532045 | -1.532045 |   6.881356 |
    | 2000-01-01 02:15:00 | 18.403065 | 6.842617  6.841399  6.835572   6.82433  6.811342  6.813769  6.849679      6.87945 | 0.0   0.231476   0.601556   0.814735   0.991458   0.886926   0.131254  -0.595711   -1.740413 | -1.740413 |   6.915254 |
    | 2000-01-01 02:20:00 |  19.80335 | 6.835714   6.83455  6.829743  6.821928  6.817329  6.832414   6.86652     6.902045 | 0.0    0.23008   0.572531   0.766827   0.886949   0.687372  -0.244908  -0.806285   -1.936059 | -1.936059 |   6.949153 |
    | 2000-01-01 02:25:00 | 21.143099 | 6.828871  6.828297  6.824849  6.821001  6.826712   6.85242  6.879694      6.92434 | 0.0     0.2281   0.540751   0.703867   0.750179   0.437434  -0.562869  -1.001986   -2.116702 | -2.116702 |   6.983051 |
    | 2000-01-01 02:30:00 | 22.360505 | 6.822261  6.822635  6.821222  6.822144  6.839583  6.870161  6.893268     6.946086 | 0.0   0.220355   0.503424   0.624332   0.567192   0.138133  -0.748883  -1.201372   -2.288679 | -2.288679 |   7.016949 |
    | 2000-01-01 02:35:00 | 23.612321 | 6.816143  6.817612  6.819184  6.826159   6.85487   6.88336  6.909388     6.967492 | 0.0   0.203931   0.455103   0.523029   0.322288  -0.187266  -0.847262  -1.384589    -2.45488 |  -2.45488 |   7.050847 |
    | 2000-01-01 02:40:00 | 24.943912 | 6.810798  6.813409  6.819168  6.833867  6.868944  6.892889  6.927044     6.989111 | 0.0   0.178151   0.388283   0.388829   0.003447  -0.465697  -0.942131  -1.530653   -2.611625 | -2.611625 |   7.084746 |
    | 2000-01-01 02:45:00 |  26.29742 | 6.806508  6.810411  6.821835  6.845102  6.877746  6.901369  6.944157     7.011295 | 0.0   0.143017    0.29292   0.204016  -0.357756  -0.651144  -1.075127  -1.645572   -2.754748 | -2.754748 |   7.118644 |
    | 2000-01-01 02:50:00 | 27.604085 | 6.803598  6.809264  6.827914  6.856942  6.882101  6.910287  6.959791     7.033937 | 0.0   0.096972   0.154355  -0.048274   -0.64027  -0.785438   -1.23137    -1.7525   -2.884639 | -2.884639 |   7.152542 |
    | 2000-01-01 02:55:00 | 28.845552 | 6.802562  6.810911  6.836778  6.865762  6.886063   6.91956  6.974446     7.056681 | 0.0   0.034532  -0.047836  -0.343301  -0.784276  -0.916323  -1.379928  -1.868425   -3.005605 | -3.005605 |   7.186441 |
    | 2000-01-01 03:00:00 | 30.044515 | 6.804208  6.816036  6.845242   6.87075  6.892143  6.928823  6.989019      7.07924 | 0.0  -0.054842  -0.311076  -0.593217   -0.84264  -1.045335  -1.508509  -1.994287   -3.122244 | -3.122244 |   7.220339 |
    | 2000-01-01 03:05:00 | 31.227561 | 6.809484  6.823835  6.850779  6.873577  6.899947  6.938233  7.004001     7.101544 | 0.0  -0.175859  -0.565837  -0.750417  -0.891746  -1.151871  -1.622362  -2.121743   -3.236933 | -3.236933 |   7.254237 |
    | 2000-01-01 03:10:00 | 32.406928 | 6.818766  6.832392  6.853734  6.876193  6.907862  6.948193  7.019453      7.12367 | 0.0  -0.309421  -0.737278  -0.835759  -0.966584  -1.230428  -1.728453  -2.243546   -3.349845 | -3.349845 |   7.288136 |
    | 2000-01-01 03:15:00 | 33.584702 | 6.831228   6.84024  6.856159  6.879598  6.914961  6.958859  7.035312     7.145727 | 0.0  -0.415397  -0.807804  -0.888649  -1.058886  -1.295519  -1.828791  -2.357417   -3.460249 | -3.460249 |   7.322034 |
    | 2000-01-01 03:20:00 | 34.760911 | 6.844973  6.847255  6.859801   6.88392  6.921492  6.970046  7.051536     7.167791 | 0.0  -0.458173  -0.808907  -0.930298  -1.146402    -1.3641  -1.923479  -2.464268   -3.567513 | -3.567513 |   7.355932 |
    | 2000-01-01 03:25:00 | 35.935604 | 6.857876  6.854274  6.865238  6.889015  6.928235  6.981492  7.068087     7.189904 | 0.0  -0.430108  -0.781035  -0.962281  -1.217038  -1.441777   -2.01404  -2.565761    -3.67139 |  -3.67139 |   7.389831 |
    | 2000-01-01 03:30:00 |  37.10751 | 6.868456  6.862197  6.872179  6.894859   6.93576  6.993086  7.084901     7.212075 | 0.0  -0.352663   -0.74884  -0.980203  -1.272381  -1.523228  -2.102934  -2.663379    -3.77194 |  -3.77194 |   7.423729 |
    | 2000-01-01 03:35:00 | 38.273939 | 6.876336  6.871319  6.880128  6.901566  6.944208  7.004903  7.101906     7.234296 | 0.0  -0.262644  -0.718736  -0.983685  -1.319035  -1.600642  -2.191514  -2.758368   -3.869411 | -3.869411 |   7.457627 |
    | 2000-01-01 03:40:00 |  39.43243 | 6.882228  6.881161  6.888794  6.909245   6.95347  7.017088  7.119075     7.256546 | 0.0  -0.196419  -0.688517  -0.977383  -1.361355  -1.670093  -2.279342  -2.851641   -3.964149 | -3.964149 |   7.491525 |
    | 2000-01-01 03:45:00 | 40.582164 | 6.887522  6.890798  6.898065  6.917904  6.963425   7.02975  7.136429     7.278805 | 0.0  -0.176456  -0.658299  -0.967333  -1.400259  -1.732085  -2.365152  -2.943589   -4.056515 | -4.056515 |   7.525424 |
    | 2000-01-01 03:50:00 |  41.72391 | 6.893594  6.899454  6.907758  6.927445  6.974031  7.042931   7.15401     7.301059 | 0.0  -0.202389  -0.635202   -0.95833   -1.43541  -1.788946  -2.448039  -3.034089   -4.146804 | -4.146804 |   7.559322 |
    | 2000-01-01 03:55:00 |  0.096101 | 6.901162  6.907002  6.917496  6.937704  6.985294  7.056636  7.171857     7.323308 | 0.0  -0.252273  -0.629674  -0.954255  -1.467191  -1.842631   -2.52787  -3.122773   -4.235203 | -4.235203 |    7.59322 |
    | 2000-01-01 04:00:00 |  1.413122 | 6.910064  6.914012  6.926862   6.94846  6.997202  7.070853  7.189987     7.345556 | 0.0   -0.29674   -0.64721   -0.95941  -1.497233  -1.894156   -2.60498  -3.209295   -4.321728 | -4.321728 |   7.627119 |
    | 2000-01-01 04:05:00 |  2.724204 | 6.919576  6.921329  6.935716  6.959461  7.009685  7.085567  7.208398     7.367815 | 0.0  -0.317054  -0.682904   -0.97805  -1.528071  -1.944172  -2.679892  -3.293615   -4.406524 | -4.406524 |   7.661017 |
    | 2000-01-01 04:10:00 |  4.029362 | 6.928968  6.929546  6.944345  6.970477  7.022617  7.100757  7.227084     7.390091 | 0.0  -0.313071  -0.723953  -1.011576  -1.562373  -1.993436  -2.752939  -3.375799   -4.489623 | -4.489623 |   7.694915 |
    | 2000-01-01 04:15:00 |  5.328351 |  6.93791   6.93875  6.953279  6.981397  7.035846  7.116384  7.246032     7.412392 | 0.0  -0.298086  -0.758292  -1.056099  -1.602125  -2.043083  -2.824411  -3.456016   -4.571064 | -4.571064 |   7.728814 |
    | 2000-01-01 04:20:00 |  6.620734 | 6.946546  6.948626  6.962935  6.992282  7.049245  7.132389  7.265226     7.434721 | 0.0  -0.287865  -0.781638  -1.103513  -1.647763  -2.094396  -2.894654  -3.534463   -4.650901 | -4.650901 |   7.762712 |
    | 2000-01-01 04:25:00 |  7.905824 | 6.955299  6.958748  6.973378   7.00332  7.062759  7.148704  7.284644     7.457078 | 0.0  -0.291748  -0.797844  -1.145937  -1.697841  -2.148331  -2.964104  -3.611347     -4.7292 |   -4.7292 |    7.79661 |
    | 2000-01-01 04:30:00 |  9.182632 | 6.964582  6.968841  6.984355  7.014714  7.076421  7.165267  7.304254     7.479461 | 0.0  -0.309434  -0.814098  -1.179994  -1.749672  -2.205067  -3.033222  -3.686895   -4.806043 | -4.806043 |   7.830508 |
    | 2000-01-01 04:35:00 | 10.449948 | 6.974586  6.978883  6.995522  7.026572  7.090317  7.182037  7.324024     7.501864 | 0.0  -0.333473  -0.835553  -1.207788  -1.800707  -2.263897  -3.102358  -3.761354   -4.881522 | -4.881522 |   7.864407 |
    | 2000-01-01 04:40:00 | 11.706539 | 6.985236  6.989038  7.006673  7.038877  7.104532  7.198998  7.343924      7.52428 | 0.0  -0.354991  -0.862764  -1.234458  -1.849718  -2.323564   -3.17164  -3.834967   -4.955744 | -4.955744 |   7.898305 |
    | 2000-01-01 04:45:00 | 12.951396 | 6.996298  6.999516   7.01783  7.051528  7.119106   7.21616  7.363933     7.546698 | 0.0  -0.368752  -0.892645  -1.264534  -1.897082  -2.382875  -3.240957  -3.907924   -5.028822 | -5.028822 |   7.932203 |
    | 2000-01-01 04:50:00 | 14.183896 | 7.007545  7.010446  7.029173  7.064421  7.134019  7.233537  7.384041     7.569109 | 0.0  -0.374878  -0.921377  -1.299504  -1.944114  -2.441202  -3.310049  -3.980321   -5.100865 | -5.100865 |   7.966102 |
    | 2000-01-01 04:55:00 | 15.403817 | 7.018862  7.021839  7.040898  7.077507  7.149216  7.251137  7.404246     7.591505 | 0.0  -0.377248  -0.946916  -1.337725  -1.992049  -2.498617  -3.378653  -4.052161   -5.171972 | -5.171972 |        8.0 |

There is no indication of an error in the water balance:

>>> round_(model.check_waterbalance(conditions))
0.0

.. _sw1d_gate_out_user_defined_control:

User-defined control
____________________

All of the above examples deal with a fixed gate opening.  However, gates are often
controlled in reality, so their opening degree depends on other properties.  Therefore,
parameter |GateHeight| alternatively accepts a callback function for adjusting its
values based on the current model state.  One can, for example, define a "sluice"
function that prevents any flow for reversed water level gradients:

>>> def sluice(model) -> None:
...     con = model.parameters.control.fastaccess
...     fac = model.sequences.factors.fastaccess
...     if fac.waterlevelupstream < fac.waterleveldownstream:
...         con.gateheight = 5.0
...     else:
...         con.gateheight = 6.5
>>> ();model.routingmodels[-1].parameters.control.gateheight(callback=sluice);()  # doctest: +ELLIPSIS
(...)

At the beginning of the simulation period, the calculated inner water levels resemble
those of the previous example.  However, the gate closes when the external water level
exceeds the inner one, so they start to even off around 6.8 m in the second half of the
simulation:

.. integration-test::

    >>> test("sw1d_gate_out_user_defined_control")
    |                date |  timestep |                                                                       waterlevels |                                                                                   discharges |  outflow | waterlevel |
    ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    | 2000-01-01 00:00:00 | 29.085815 |      7.0       7.0       7.0       7.0  6.999999   6.99991    6.9918     6.854698 | 0.0        0.0        0.0        0.0        0.0    0.00002   0.004525   0.277863    7.542971 | 7.542971 |        6.0 |
    | 2000-01-01 00:05:00 | 29.085815 |      7.0       7.0       7.0  6.999999  6.999909  6.997342  6.950328     6.752126 | 0.0        0.0        0.0        0.0   0.000057   0.003053   0.131468   1.513864    6.642449 | 6.642449 |   6.033898 |
    | 2000-01-01 00:10:00 | 29.085815 |      7.0       7.0  6.999999   6.99996  6.998725  6.985382  6.894698     6.682254 | 0.0        0.0   0.000001   0.000039   0.002002    0.04147   0.639471     2.4938      5.9874 |   5.9874 |   6.067797 |
    | 2000-01-01 00:15:00 | 29.085813 |      7.0  6.999999  6.999976   6.99957  6.993281  6.961969  6.852337     6.628468 | 0.0   0.000001   0.000029   0.000779   0.020247   0.201736   1.372385   2.784436    5.473738 | 5.473738 |   6.101695 |
    | 2000-01-01 00:20:00 | 29.085751 |      7.0  6.999991  6.999787   6.99772  6.980391  6.935005  6.823652     6.584729 | 0.0   0.000013   0.000436   0.006764   0.099272   0.528941   1.877143   2.833292    5.020232 | 5.020232 |   6.135593 |
    | 2000-01-01 00:25:00 | 29.085097 | 6.999995  6.999925  6.998882  6.992498  6.961846   6.91187  6.800189     6.549715 | 0.0    0.00016   0.003444    0.03359    0.29469   0.912842    2.06958   2.851677     4.60239 |  4.60239 |   6.169492 |
    | 2000-01-01 00:30:00 | 29.080946 | 6.999959  6.999604  6.996099  6.982767  6.943737  6.893527  6.778129      6.52252 | 0.0   0.001182   0.017251   0.110013   0.596559   1.200191   2.117342   2.852666    4.212438 | 4.212438 |    6.20339 |
    | 2000-01-01 00:35:00 | 29.063001 | 6.999781  6.998514  6.990173  6.969923  6.929938  6.878036  6.757369     6.502195 | 0.0   0.005954   0.060444   0.257989   0.900223   1.360211   2.134766   2.826781    3.843036 | 3.843036 |   6.237288 |
    | 2000-01-01 00:40:00 | 29.006184 | 6.999123  6.995812   6.98109  6.957007  6.919606  6.864003  6.738567      6.48802 | 0.0   0.021921   0.157032   0.459811   1.105571   1.449954   2.151581   2.778309    3.487057 | 3.487057 |   6.271186 |
    | 2000-01-01 00:45:00 | 28.867863 | 6.997275   6.99075  6.970737  6.946139  6.910251  6.850992   6.72208     6.479543 | 0.0   0.061619   0.314704   0.659775   1.203196   1.515027   2.165592   2.715153    3.138959 | 3.138959 |   6.305085 |
    | 2000-01-01 00:50:00 | 28.599206 | 6.993195  6.983393  6.961515  6.937512  6.900555  6.838868  6.707977      6.47649 | 0.0   0.135987   0.503827   0.811229   1.242579   1.565777   2.171967   2.642096    2.794773 | 2.794773 |   6.338983 |
    | 2000-01-01 00:55:00 |  28.16875 | 6.985983  6.974788  6.954386  6.930294   6.89064   6.82749  6.696217     6.478671 | 0.0    0.24041   0.670676   0.908321   1.269215   1.599729   2.168636   2.560633    2.451569 | 2.451569 |   6.372881 |
    | 2000-01-01 01:00:00 | 27.581018 | 6.975572  6.966169   6.94861  6.923679  6.881118  6.816765  6.686754     6.485938 | 0.0   0.347037   0.777989   0.970511   1.301268    1.61865   2.154913   2.470343    2.107022 | 2.107022 |    6.40678 |
    | 2000-01-01 01:05:00 | 26.876323 | 6.963027   6.95803  6.942919  6.917231  6.872365   6.80673  6.679582      6.49815 | 0.0   0.418143   0.825097   1.014817   1.337221    1.62898   2.130721   2.369762    1.759124 | 1.759124 |   6.440678 |
    | 2000-01-01 01:10:00 | 26.114166 | 6.950085      6.95  6.936518  6.910759  6.864377  6.797524  6.674774      6.51517 | 0.0    0.43141   0.832887   1.046262   1.369856   1.636153   2.096463   2.256732    1.405745 | 1.405745 |   6.474576 |
    | 2000-01-01 01:15:00 | 25.351845 | 6.938309  6.941428  6.929248  6.904145  6.856953  6.789304   6.67251     6.537102 | 0.0   0.392535   0.821139   1.063462   1.394142   1.641583   2.052586   2.128056    1.031462 | 1.031462 |   6.508475 |
    | 2000-01-01 01:20:00 | 24.628915 | 6.928474  6.932001  6.921255   6.89729  6.849902  6.782197  6.673092     6.563519 | 0.0   0.327824   0.799196   1.065638   1.408419   1.643469   1.998814   1.979422    0.658576 | 0.658576 |   6.542373 |
    | 2000-01-01 01:25:00 | 23.961426 | 6.920424  6.921979  6.912698  6.890126  6.843119  6.776301  6.676659     6.591816 | 0.0   0.268333   0.769418   1.054632   1.412841   1.638943   1.933714   1.814813     0.39995 |  0.39995 |   6.576271 |
    | 2000-01-01 01:30:00 | 23.344012 |  6.91334  6.912017  6.903719  6.882638  6.836591  6.771697  6.683067     6.620414 | 0.0   0.236152   0.734258   1.033571   1.407962    1.62556   1.855783    1.64217    0.212278 | 0.212278 |   6.610169 |
    | 2000-01-01 01:35:00 | 22.757171 | 6.906239  6.902756  6.894541  6.874868  6.830363  6.768445  6.691981     6.649035 | 0.0   0.236703   0.699765   1.005697   1.394182   1.601765   1.764352   1.467239    0.036191 | 0.036191 |   6.644068 |
    | 2000-01-01 01:40:00 |  22.17768 | 6.898471  6.894461  6.885515  6.866923  6.824513  6.766591  6.703037     6.674854 | 0.0   0.258912   0.673647   0.974514   1.371762   1.566769   1.659479   1.290947         0.0 |      0.0 |   6.677966 |
    | 2000-01-01 01:45:00 | 21.588805 | 6.889963  6.886923  6.877007  6.858984  6.819138  6.766164  6.715579     6.697324 | 0.0    0.28361   0.660532    0.94414   1.341093    1.52025   1.541583   1.123504         0.0 |      0.0 |   6.711864 |
    | 2000-01-01 01:50:00 |  20.98588 | 6.881103  6.879656   6.86921  6.851296  6.814362  6.767152  6.728714     6.716822 | 0.0   0.295321   0.658645    0.91854   1.302944   1.462149   1.412738   0.974899         0.0 |      0.0 |   6.745763 |
    | 2000-01-01 01:55:00 | 20.375189 | 6.872417  6.872232  6.862043   6.84412  6.810332  6.769462  6.741574     6.733795 | 0.0    0.28955   0.660772   0.899653   1.258475   1.392804   1.277314   0.848663         0.0 |      0.0 |   6.779661 |
    | 2000-01-01 02:00:00 | 19.768161 | 6.864259  6.864495  6.855232  6.837658  6.807201  6.772905  6.753529     6.748648 | 0.0   0.271921   0.658756   0.885814   1.208899   1.313273   1.141148   0.742657         0.0 |      0.0 |   6.813559 |
    | 2000-01-01 02:05:00 | 19.174904 | 6.856694   6.85658  6.848508     6.832  6.805083  6.777213  6.764272     6.761688 | 0.0   0.252176   0.647936   0.872041   1.154942   1.225536   1.010098   0.651976         0.0 |      0.0 |   6.847458 |
    | 2000-01-01 02:10:00 | 18.600305 | 6.849553   6.84877  6.841793  6.827117  6.804007  6.782086  6.773791     6.773116 | 0.0   0.238025   0.628502   0.852332   1.096475   1.132356   0.888706    0.57143         0.0 |      0.0 |   6.881356 |
    | 2000-01-01 02:15:00 | 18.043954 | 6.842597  6.841334  6.835229  6.822914  6.803883  6.787235  6.782248     6.783065 | 0.0   0.231861   0.603677   0.822484   1.032626   1.036769   0.779347   0.497419         0.0 |      0.0 |   6.915254 |
    | 2000-01-01 02:20:00 |  17.50309 |  6.83567  6.834417  6.829083  6.819298  6.804512  6.792421  6.789851     6.791639 | 0.0   0.230902   0.576748   0.781619   0.962399   0.941413   0.682127   0.428724         0.0 |      0.0 |   6.949153 |
    | 2000-01-01 02:25:00 |  16.97642 | 6.828777  6.828033  6.823599  6.816225  6.805638  6.797469  6.796734     6.798961 | 0.0   0.229763   0.548962   0.731781   0.885454    0.84794   0.595535   0.366096         0.0 |      0.0 |   6.983051 |
    | 2000-01-01 02:30:00 | 16.466655 | 6.822069  6.822122  6.818887  6.813698  6.807011  6.802255  6.802928     6.805182 | 0.0   0.223611   0.519172   0.676235     0.8026   0.756814   0.517512   0.311032         0.0 |      0.0 |   7.016949 |
    | 2000-01-01 02:35:00 | 15.980727 | 6.815763  6.816627  6.814905  6.811736  6.808455  6.806679  6.808387      6.81047 | 0.0   0.210207   0.484937   0.617646   0.715712   0.667597   0.446402   0.264429         0.0 |      0.0 |   7.050847 |
    | 2000-01-01 02:40:00 |  15.55036 | 6.810058  6.811548  6.811518  6.810334   6.80988  6.810645  6.813055     6.814985 | 0.0   0.190145   0.444109   0.557024   0.627139   0.579636   0.381328   0.225742         0.0 |      0.0 |   7.084746 |
    | 2000-01-01 02:45:00 | 15.646111 | 6.805085  6.806945  6.808583   6.80943  6.811264  6.814062  6.816922     6.818846 | 0.0   0.165772    0.39592   0.493737   0.538922   0.492777   0.321927   0.193018         0.0 |      0.0 |   7.118644 |
    | 2000-01-01 02:50:00 | 15.926741 | 6.800893  6.802917  6.806027  6.808914  6.812598  6.816862  6.820044     6.822118 | 0.0   0.139731   0.341127   0.426325   0.452166   0.407696     0.2677   0.163622         0.0 |      0.0 |   7.152542 |
    | 2000-01-01 02:55:00 | 16.155465 | 6.797477  6.799566  6.803862  6.808647  6.813836  6.819024  6.822514     6.824823 | 0.0   0.113886   0.281431    0.35361   0.366949   0.325692    0.21756   0.135231         0.0 |      0.0 |   7.186441 |
    | 2000-01-01 03:00:00 | 16.337203 |  6.79481  6.796971  6.802157  6.808502  6.814878  6.820586  6.824416     6.826952 | 0.0   0.088889   0.218653   0.275478   0.282707   0.247961   0.169857   0.106472         0.0 |      0.0 |   7.220339 |
    | 2000-01-01 03:05:00 | 16.475098 |  6.79288  6.795175  6.800989  6.808387  6.815601  6.821624  6.825793     6.828492 | 0.0   0.064336   0.154122   0.193071   0.198836   0.174734   0.122873    0.07697         0.0 |      0.0 |   7.254237 |
    | 2000-01-01 03:10:00 | 16.570129 | 6.791702   6.79419  6.800391  6.808253  6.815912  6.822212  6.826647     6.829431 | 0.0   0.039272   0.088509   0.108451    0.11517   0.104812   0.075418   0.046948         0.0 |      0.0 |   7.288136 |
    | 2000-01-01 03:15:00 | 16.621742 | 6.791318  6.794005  6.800334  6.808092  6.815798  6.822386  6.826957     6.829765 | 0.0   0.012786   0.022076   0.023975   0.032019   0.035826   0.027084   0.016745         0.0 |      0.0 |   7.322034 |
    | 2000-01-01 03:20:00 | 16.628896 | 6.791783  6.794585  6.800731  6.807933  6.815344  6.822132  6.826703     6.829497 | 0.0  -0.015481  -0.044491  -0.057723  -0.049773  -0.034628  -0.021921  -0.013445         0.0 |      0.0 |   7.355932 |
    | 2000-01-01 03:25:00 | 16.591112 | 6.793121  6.795842  6.801444  6.807833  6.814721  6.821428  6.825892     6.828632 | 0.0  -0.044597  -0.107436  -0.131219  -0.126235  -0.105473  -0.070249  -0.043213         0.0 |      0.0 |   7.389831 |
    | 2000-01-01 03:30:00 | 16.509934 | 6.795283  6.797626  6.802352  6.807849  6.814092  6.820313  6.824573     6.827198 | 0.0  -0.072086  -0.161279  -0.191551  -0.192374   -0.17141  -0.115657  -0.071699         0.0 |      0.0 |   7.423729 |
    | 2000-01-01 03:35:00 | 16.389148 | 6.798121  6.799771  6.803408  6.808018  6.813524  6.818904  6.822824     6.825241 | 0.0  -0.094598  -0.201867  -0.237056  -0.245484  -0.226576  -0.156145  -0.097846         0.0 |      0.0 |   7.457627 |
    | 2000-01-01 03:40:00 | 16.234369 |  6.80139  6.802141  6.804631  6.808345  6.812998  6.817358  6.820744     6.822833 | 0.0  -0.108958   -0.22748  -0.268251  -0.284615  -0.267059  -0.189775  -0.120425         0.0 |      0.0 |   7.491525 |
    | 2000-01-01 03:45:00 | 16.052961 | 6.804793  6.804649  6.806057  6.808812   6.81247  6.815809  6.818449      6.82007 | 0.0  -0.113455  -0.238821  -0.286342  -0.309686   -0.29209  -0.214619  -0.138126         0.0 |      0.0 |   7.525424 |
    | 2000-01-01 03:50:00 | 15.853835 | 6.808054  6.807237  6.807685  6.809387  6.811938  6.814325  6.816064     6.817077 | 0.0  -0.108669  -0.238107  -0.292386  -0.321128  -0.303408  -0.229199  -0.149687         0.0 |      0.0 |   7.559322 |
    | 2000-01-01 03:55:00 | 15.646609 | 6.810974  6.809849  6.809463  6.810042  6.811447  6.812914  6.813695     6.813995 | 0.0  -0.097359  -0.227954  -0.287224  -0.319962  -0.303578  -0.233047  -0.154088         0.0 |      0.0 |    7.59322 |
    | 2000-01-01 04:00:00 | 15.450424 | 6.813477  6.812394  6.811298  6.810762   6.81105   6.81156  6.811415     6.810978 | 0.0  -0.083428  -0.210672  -0.271825  -0.307818   -0.29459  -0.226858  -0.150866         0.0 |      0.0 |   7.627119 |
    | 2000-01-01 04:05:00 | 15.530987 |  6.81559  6.814749  6.813081  6.811542  6.810775  6.810253  6.809264     6.808169 | 0.0   -0.07043  -0.188148  -0.247608  -0.286614  -0.277434  -0.212112  -0.140416         0.0 |      0.0 |   7.661017 |
    | 2000-01-01 04:10:00 | 15.694393 | 6.817398  6.816785  6.814715  6.812372  6.810607  6.809013  6.807272     6.805688 | 0.0  -0.060266  -0.162067  -0.216522  -0.258052  -0.252479   -0.19047  -0.124067         0.0 |      0.0 |   7.694915 |
    | 2000-01-01 04:15:00 | 15.833603 | 6.818978  6.818413  6.816118  6.813221  6.810511  6.807878  6.805485     6.803612 | 0.0  -0.052676  -0.134086  -0.180858  -0.223301  -0.220091   -0.16336  -0.103796         0.0 |      0.0 |   7.728814 |
    | 2000-01-01 04:20:00 |  15.94942 | 6.820351  6.819612  6.817234  6.814024   6.81045  6.806897  6.803976     6.801979 | 0.0  -0.045762  -0.105722    -0.1429  -0.183052  -0.180999  -0.131955  -0.081649         0.0 |      0.0 |   7.762712 |
    | 2000-01-01 04:25:00 |  16.04178 | 6.821469  6.820427  6.818029  6.814692  6.810402  6.806119  6.802829     6.800796 | 0.0  -0.037252  -0.078001  -0.104525   -0.13789  -0.136311  -0.097367  -0.059142         0.0 |      0.0 |    7.79661 |
    | 2000-01-01 04:30:00 | 16.109512 | 6.822244  6.820933  6.818501  6.815129  6.810362  6.805587  6.802113     6.800058 | 0.0  -0.025837  -0.051153   -0.06686  -0.088714  -0.087363  -0.060809  -0.036931         0.0 |      0.0 |   7.830508 |
    | 2000-01-01 04:35:00 | 16.150837 | 6.822599  6.821189  6.818665  6.815265  6.810323  6.805345  6.801855     6.799759 | 0.0  -0.011832  -0.024628  -0.030104  -0.036931  -0.035636  -0.023521  -0.014916         0.0 |      0.0 |   7.864407 |
    | 2000-01-01 04:40:00 | 16.164193 | 6.822505  6.821201  6.818548   6.81508  6.810277  6.805419  6.802039     6.799905 | 0.0   0.003114   0.002506   0.006383   0.015617   0.017153   0.013452   0.007312         0.0 |      0.0 |   7.898305 |
    | 2000-01-01 04:45:00 | 16.148935 | 6.821997  6.820925  6.818174  6.814625   6.81022    6.8058  6.802614     6.800501 | 0.0   0.016949   0.030785   0.043266   0.066057   0.067962   0.048938   0.029764         0.0 |      0.0 |   7.932203 |
    | 2000-01-01 04:50:00 | 16.105793 | 6.821148    6.8203  6.817559  6.814013  6.810166  6.806419   6.80351     6.801533 | 0.0   0.028307   0.059554   0.080054   0.110651   0.112451   0.081465   0.051595         0.0 |      0.0 |   7.966102 |
    | 2000-01-01 04:55:00 |  16.03679 | 6.820032  6.819299  6.816723  6.813376   6.81015  6.807175  6.804659      6.80296 | 0.0   0.037197   0.087252    0.11513   0.146973   0.147496   0.109694   0.071385         0.0 |      0.0 |        8.0 |

There is no indication of an error in the water balance:

>>> round_(model.check_waterbalance(conditions))
0.0
"""
# import...
# ...from HydPy
from hydpy.exe.modelimports import *
from hydpy.core import modeltools
from hydpy.interfaces import channelinterfaces

# ...from musk
from hydpy.models.sw1d import sw1d_model


class Model(modeltools.AdHocModel, channelinterfaces.RoutingModel_V3):
    """A routing submodel for calculating "longitudinal" outflow from the last segment
    of a channel as the flow under a submerged gate."""

    INLET_METHODS = ()
    RECEIVER_METHODS = ()
    RUN_METHODS = ()
    INTERFACE_METHODS = (
        sw1d_model.Perform_Preprocessing_V5,
        sw1d_model.Determine_MaxTimeStep_V5,
        sw1d_model.Determine_Discharge_V6,
        sw1d_model.Get_MaxTimeStep_V1,
        sw1d_model.Get_Discharge_V1,
        sw1d_model.Get_PartialDischargeDownstream_V1,
        sw1d_model.Get_DischargeVolume_V1,
        sw1d_model.Set_TimeStep_V1,
        sw1d_model.Perform_Postprocessing_V2,
    )
    ADD_METHODS = (
        sw1d_model.Pick_WaterLevelDownstream_V1,
        sw1d_model.Reset_DischargeVolume_V1,
        sw1d_model.Calc_WaterLevelUpstream_V1,
        sw1d_model.Calc_WaterLevel_V5,
        sw1d_model.Calc_MaxTimeStep_V5,
        sw1d_model.Calc_Discharge_V3,
        sw1d_model.Update_DischargeVolume_V1,
        sw1d_model.Pass_Discharge_V1,
    )
    OUTLET_METHODS = ()
    SENDER_METHODS = ()
    SUBMODELINTERFACES = (
        channelinterfaces.RoutingModel_V1,
        channelinterfaces.RoutingModel_V2,
        channelinterfaces.StorageModel_V1,
    )
    SUBMODELS = ()

    storagemodelupstream = modeltools.SubmodelProperty(
        channelinterfaces.StorageModel_V1, sidemodel=True
    )
    storagemodelupstream_is_mainmodel = modeltools.SubmodelIsMainmodelProperty()
    storagemodelupstream_typeid = modeltools.SubmodelTypeIDProperty()

    routingmodelsupstream = modeltools.SubmodelsProperty(
        channelinterfaces.RoutingModel_V1,
        channelinterfaces.RoutingModel_V2,
        sidemodels=True,
    )


tester = Tester()
cythonizer = Cythonizer()
