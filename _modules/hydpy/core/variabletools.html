
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>hydpy.core.variabletools &#8212; HydPy 4.0a11 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 4.0a11 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.core.variabletools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module implements general features for defining and working with</span>
<span class="sd">model parameters and sequences.</span>

<span class="sd">Features more specific to either parameters or sequences are implemented</span>
<span class="sd">in modules |parametertools| and |sequencetools| respectively.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># import...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="o">*</span>
<span class="c1"># ...from site-packages</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="c1"># ...from HydPy</span>
<span class="kn">import</span> <span class="nn">hydpy</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">masktools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">objecttools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">typingtools</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">parametertools</span>
    <span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">sequencetools</span>


<span class="n">GroupType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span>
    <span class="s1">&#39;GroupType&#39;</span><span class="p">,</span>
    <span class="s1">&#39;parametertools.Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;sequencetools.Sequences&#39;</span><span class="p">)</span>


<span class="n">SubgroupType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span>
    <span class="s1">&#39;SubgroupType&#39;</span><span class="p">,</span>
    <span class="s1">&#39;parametertools.SubParameters&#39;</span><span class="p">,</span> <span class="s1">&#39;sequencetools.SubSequences&#39;</span><span class="p">)</span>


<span class="n">INT_NAN</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999999</span>
<span class="sd">&quot;&quot;&quot;Surrogate for `nan`, which is available for floating point values</span>
<span class="sd">but not for integer values.&quot;&quot;&quot;</span>

<span class="n">TYPE2MISSINGVALUE</span> <span class="o">=</span> <span class="p">{</span><span class="nb">float</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                     <span class="nb">int</span><span class="p">:</span> <span class="n">INT_NAN</span><span class="p">,</span>
                     <span class="nb">bool</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>


<div class="viewcode-block" id="trim"><a class="viewcode-back" href="../../../variabletools.html#hydpy.core.variabletools.trim">[docs]</a><span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Variable&#39;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Trim the value(s) of a |Variable| instance.</span>

<span class="sd">    Usually, users do not need to apply function |trim| directly.</span>
<span class="sd">    Instead, some |Variable| subclasses implement their own `trim`</span>
<span class="sd">    methods relying on function |trim|.  Model developers should</span>
<span class="sd">    implement individual `trim` methods for their |Parameter| or</span>
<span class="sd">    |Sequence| subclasses when their boundary values depend on the</span>
<span class="sd">    actual project configuration (one example is soil moisture;</span>
<span class="sd">    its lowest possible value should possibly be zero in all cases,</span>
<span class="sd">    but its highest possible value could depend on another parameter</span>
<span class="sd">    defining the maximum storage capacity).</span>

<span class="sd">    For the following examples, we prepare a simple (not fully</span>
<span class="sd">    functional) |Variable| subclass, making use of function |trim|</span>
<span class="sd">    without any modifications.  Function |trim| works slightly</span>
<span class="sd">    different for variables handling |float|, |int|, and |bool|</span>
<span class="sd">    values.  We start with the most common content type |float|:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.variabletools import trim, Variable</span>
<span class="sd">    &gt;&gt;&gt; class Var(Variable):</span>
<span class="sd">    ...     NDIM = 0</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     SPAN = 1.0, 3.0</span>
<span class="sd">    ...     trim = trim</span>
<span class="sd">    ...     initinfo = 2.0, False</span>
<span class="sd">    ...     __hydpy__connect_variable2subgroup__ = None</span>

<span class="sd">    First, we enable the printing of warning messages raised by function</span>
<span class="sd">    |trim|:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; pub.options.warntrim = True</span>

<span class="sd">    When not passing boundary values, function |trim| extracts them from</span>
<span class="sd">    class attribute `SPAN` of the given |Variable| instance, if available:</span>

<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var.value = 2.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(2.0)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 0.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    UserWarning: For variable `var` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `0.0` and `1.0`, respectively.</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(1.0)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 4.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    UserWarning: For variable `var` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `4.0` and `3.0`, respectively.</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(3.0)</span>

<span class="sd">    In the examples above, outlier values are set to the respective</span>
<span class="sd">    boundary value, accompanied by suitable warning messages.  For</span>
<span class="sd">    minimal deviations (defined by function |get_tolerance|), which</span>
<span class="sd">    might be due to precision problems only, outliers are trimmed</span>
<span class="sd">    but not reported:</span>

<span class="sd">    &gt;&gt;&gt; var.value = 1.0 - 1e-15</span>
<span class="sd">    &gt;&gt;&gt; var == 1.0</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; trim(var)</span>
<span class="sd">    &gt;&gt;&gt; var == 1.0</span>
<span class="sd">    True</span>

<span class="sd">    &gt;&gt;&gt; var.value = 3.0 + 1e-15</span>
<span class="sd">    &gt;&gt;&gt; var == 3.0</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var == 3.0</span>
<span class="sd">    True</span>

<span class="sd">    Use arguments `lower` and `upper` to override the (eventually)</span>
<span class="sd">    available `SPAN` entries:</span>

<span class="sd">    &gt;&gt;&gt; var.trim(lower=4.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    UserWarning: For variable `var` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `3.0` and `4.0`, respectively.</span>

<span class="sd">    &gt;&gt;&gt; var.trim(upper=3.0)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    UserWarning: For variable `var` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `4.0` and `3.0`, respectively.</span>

<span class="sd">    Function |trim| interprets both |None| and |numpy.nan| values as if</span>
<span class="sd">    no boundary value exists:</span>

<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; var.value = 0.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim(lower=numpy.nan)</span>
<span class="sd">    &gt;&gt;&gt; var.value = 5.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim(upper=numpy.nan)</span>

<span class="sd">    You can disable function |trim| via option |Options.trimvariables|:</span>

<span class="sd">    &gt;&gt;&gt; with pub.options.trimvariables(False):</span>
<span class="sd">    ...     var.value = 5.0</span>
<span class="sd">    ...     var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(5.0)</span>

<span class="sd">    Alternatively, you can omit the warning messages only:</span>

<span class="sd">    &gt;&gt;&gt; with pub.options.warntrim(False):</span>
<span class="sd">    ...     var.value = 5.0</span>
<span class="sd">    ...     var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(3.0)</span>

<span class="sd">    If a |Variable| subclass does not have (fixed) boundaries, give it</span>
<span class="sd">    either no `SPAN` attribute or a |tuple| containing |None| values:</span>

<span class="sd">    &gt;&gt;&gt; del Var.SPAN</span>
<span class="sd">    &gt;&gt;&gt; var.value = 5.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(5.0)</span>

<span class="sd">    &gt;&gt;&gt; Var.SPAN = (None, None)</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(5.0)</span>

<span class="sd">    The above examples deal with a 0-dimensional |Variable| subclass.</span>
<span class="sd">    The following examples repeat the most relevant examples for a</span>
<span class="sd">    2-dimensional subclass:</span>

<span class="sd">    &gt;&gt;&gt; Var.SPAN = 1.0, 3.0</span>
<span class="sd">    &gt;&gt;&gt; Var.NDIM = 2</span>
<span class="sd">    &gt;&gt;&gt; var.shape = 1, 3</span>
<span class="sd">    &gt;&gt;&gt; var.values = 2.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>

<span class="sd">    &gt;&gt;&gt; var.values = 0.0, 1.0, 2.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    UserWarning: For variable `var` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `0.0, 1.0, 2.0` and `1.0, 1.0, 2.0`, \</span>
<span class="sd">respectively.</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var([[1.0, 1.0, 2.0]])</span>

<span class="sd">    &gt;&gt;&gt; var.values = 2.0, 3.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    UserWarning: For variable `var` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `2.0, 3.0, 4.0` and `2.0, 3.0, 3.0`, \</span>
<span class="sd">respectively.</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var([[2.0, 3.0, 3.0]])</span>

<span class="sd">    &gt;&gt;&gt; var.values = 1.0-1e-15, 2.0, 3.0+1e-15</span>
<span class="sd">    &gt;&gt;&gt; var.values == (1.0, 2.0, 3.0)</span>
<span class="sd">    array([[False,  True, False]], dtype=bool)</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var.values == (1.0, 2.0, 3.0)</span>
<span class="sd">    array([[ True,  True,  True]], dtype=bool)</span>

<span class="sd">    &gt;&gt;&gt; var.values = 0.0, 2.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim(lower=numpy.nan, upper=numpy.nan)</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var([[0.0, 2.0, 4.0]])</span>

<span class="sd">    &gt;&gt;&gt; var.trim(lower=[numpy.nan, 3.0, 3.0])</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    UserWarning: For variable `var` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `0.0, 2.0, 4.0` and `0.0, 3.0, 3.0`, \</span>
<span class="sd">respectively.</span>

<span class="sd">    &gt;&gt;&gt; var.values = 0.0, 2.0, 4.0</span>
<span class="sd">    &gt;&gt;&gt; var.trim(upper=[numpy.nan, 1.0, numpy.nan])</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    UserWarning: For variable `var` at least one value needed to be trimmed.  \</span>
<span class="sd">The old and the new value(s) are `0.0, 2.0, 4.0` and `1.0, 1.0, 4.0`, \</span>
<span class="sd">respectively.</span>

<span class="sd">    For |Variable| subclasses handling |float| values, setting outliers</span>
<span class="sd">    to the respective boundary value might often be an acceptable approach.</span>
<span class="sd">    However, this is often not the case for subclasses handling |int|</span>
<span class="sd">    values, which often serve as option flags (e.g. to enable/disable</span>
<span class="sd">    a certain hydrological process for different land-use types). Hence,</span>
<span class="sd">    function |trim| raises an exception instead of a warning and does</span>
<span class="sd">    not modify the wrong |int| value:</span>

<span class="sd">    &gt;&gt;&gt; Var.TYPE = int</span>
<span class="sd">    &gt;&gt;&gt; Var.NDIM = 0</span>
<span class="sd">    &gt;&gt;&gt; Var.SPAN = 1, 3</span>

<span class="sd">    &gt;&gt;&gt; var.value = 2</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(2)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: The value `0` of parameter `var` of element `?` is not valid.</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(0)</span>
<span class="sd">    &gt;&gt;&gt; var.value = 4</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: The value `4` of parameter `var` of element `?` is not valid.</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(4)</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import INT_NAN</span>
<span class="sd">    &gt;&gt;&gt; var.value = 0</span>
<span class="sd">    &gt;&gt;&gt; var.trim(lower=0)</span>
<span class="sd">    &gt;&gt;&gt; var.trim(lower=INT_NAN)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 4</span>
<span class="sd">    &gt;&gt;&gt; var.trim(upper=4)</span>
<span class="sd">    &gt;&gt;&gt; var.trim(upper=INT_NAN)</span>

<span class="sd">    &gt;&gt;&gt; Var.SPAN = 1, None</span>
<span class="sd">    &gt;&gt;&gt; var.value = 0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: The value `0` of parameter `var` of element `?` is not valid.</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(0)</span>

<span class="sd">    &gt;&gt;&gt; Var.SPAN = None, 3</span>
<span class="sd">    &gt;&gt;&gt; var.value = 0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var.value = 4</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: The value `4` of parameter `var` of element `?` is not valid.</span>

<span class="sd">    &gt;&gt;&gt; del Var.SPAN</span>
<span class="sd">    &gt;&gt;&gt; var.value = 0</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    &gt;&gt;&gt; var.value = 4</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>

<span class="sd">    &gt;&gt;&gt; Var.SPAN = 1, 3</span>
<span class="sd">    &gt;&gt;&gt; Var.NDIM = 2</span>
<span class="sd">    &gt;&gt;&gt; var.shape = (1, 3)</span>
<span class="sd">    &gt;&gt;&gt; var.values = 2</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>

<span class="sd">    &gt;&gt;&gt; var.values = 0, 1, 2</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: At least one value of parameter `var` of element `?` \</span>
<span class="sd">is not valid.</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var([[0, 1, 2]])</span>
<span class="sd">    &gt;&gt;&gt; var.values = 2, 3, 4</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">     ...</span>
<span class="sd">    ValueError: At least one value of parameter `var` of element `?` \</span>
<span class="sd">is not valid.</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var([[2, 3, 4]])</span>


<span class="sd">    &gt;&gt;&gt; var.values = 0, 0, 2</span>
<span class="sd">    &gt;&gt;&gt; var.trim(lower=[0, INT_NAN, 2])</span>

<span class="sd">    &gt;&gt;&gt; var.values = 2, 4, 4</span>
<span class="sd">    &gt;&gt;&gt; var.trim(upper=[2, INT_NAN, 4])</span>

<span class="sd">    For |bool| values, defining outliers does not make much sense,</span>
<span class="sd">    which is why function |trim| does nothing when applied on</span>
<span class="sd">    variables handling |bool| values:</span>

<span class="sd">    &gt;&gt;&gt; Var.TYPE = bool</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>

<span class="sd">    If function |trim| encounters an unmanageable type, it raises an</span>
<span class="sd">    exception like the following:</span>

<span class="sd">    &gt;&gt;&gt; Var.TYPE = str</span>
<span class="sd">    &gt;&gt;&gt; var.trim()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    NotImplementedError: Method `trim` can only be applied on parameters \</span>
<span class="sd">handling floating point, integer, or boolean values, but the &quot;value type&quot; \</span>
<span class="sd">of parameter `var` is `str`.</span>

<span class="sd">    &gt;&gt;&gt; pub.options.warntrim = False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">trimvariables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPAN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">upper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPAN</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;TYPE&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_trim_float_0d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_trim_float_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_trim_int_0d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_trim_int_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;Method `trim` can only be applied on parameters &#39;</span>
                <span class="n">f</span><span class="s1">&#39;handling floating point, integer, or boolean values, &#39;</span>
                <span class="n">f</span><span class="s1">&#39;but the &quot;value type&quot; of parameter `</span><span class="si">{self.name}</span><span class="s1">` is &#39;</span>
                <span class="n">f</span><span class="s1">&#39;`{objecttools.classname(self.TYPE)}`.&#39;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_trim_float_0d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">lower</span><span class="p">):</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">upper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">upper</span><span class="p">):</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">:</span>
        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">lower</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">old</span> <span class="o">+</span> <span class="n">get_tolerance</span><span class="p">(</span><span class="n">old</span><span class="p">))</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">lower</span> <span class="o">-</span> <span class="n">get_tolerance</span><span class="p">(</span><span class="n">lower</span><span class="p">)):</span>
            <span class="n">_warn_trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldvalue</span><span class="o">=</span><span class="n">old</span><span class="p">,</span> <span class="n">newvalue</span><span class="o">=</span><span class="n">lower</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">:</span>
        <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">upper</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">old</span> <span class="o">-</span> <span class="n">get_tolerance</span><span class="p">(</span><span class="n">old</span><span class="p">))</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">upper</span> <span class="o">+</span> <span class="n">get_tolerance</span><span class="p">(</span><span class="n">upper</span><span class="p">)):</span>
            <span class="n">_warn_trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldvalue</span><span class="o">=</span><span class="n">old</span><span class="p">,</span> <span class="n">newvalue</span><span class="o">=</span><span class="n">upper</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_trim_float_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">lower</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">lower</span><span class="p">))]</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">if</span> <span class="n">upper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">upper</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">upper</span><span class="p">))]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
    <span class="n">values</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">values</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">)</span> <span class="ow">or</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">values</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">):</span>
        <span class="n">old</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">trimmed</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">trimmed</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">old</span> <span class="o">+</span> <span class="n">get_tolerance</span><span class="p">(</span><span class="n">old</span><span class="p">))</span> <span class="o">&lt;</span>
                      <span class="p">(</span><span class="n">lower</span> <span class="o">-</span> <span class="n">get_tolerance</span><span class="p">(</span><span class="n">lower</span><span class="p">)))</span> <span class="ow">or</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">old</span> <span class="o">-</span> <span class="n">get_tolerance</span><span class="p">(</span><span class="n">old</span><span class="p">))</span> <span class="o">&gt;</span>
                          <span class="p">(</span><span class="n">upper</span> <span class="o">+</span> <span class="n">get_tolerance</span><span class="p">(</span><span class="n">upper</span><span class="p">)))):</span>
            <span class="n">_warn_trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldvalue</span><span class="o">=</span><span class="n">old</span><span class="p">,</span> <span class="n">newvalue</span><span class="o">=</span><span class="n">trimmed</span><span class="p">)</span>
    <span class="n">values</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>


<span class="k">def</span> <span class="nf">_trim_int_0d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">INT_NAN</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">upper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">upper</span> <span class="o">==</span> <span class="n">INT_NAN</span><span class="p">):</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="n">INT_NAN</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span> <span class="o">!=</span> <span class="n">INT_NAN</span><span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="bp">self</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;The value `</span><span class="si">{self.value}</span><span class="s1">` of parameter &#39;</span>
            <span class="n">f</span><span class="s1">&#39;{objecttools.elementphrase(self)} is not valid.&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_trim_int_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lower</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">INT_NAN</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">upper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="n">INT_NAN</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">upper</span><span class="p">[</span><span class="n">upper</span> <span class="o">==</span> <span class="n">INT_NAN</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">INT_NAN</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="n">INT_NAN</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">&lt;</span> <span class="n">lower</span><span class="p">)</span> <span class="ow">or</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">&gt;</span> <span class="n">upper</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;At least one value of parameter &#39;</span>
            <span class="n">f</span><span class="s1">&#39;{objecttools.elementphrase(self)} is not valid.&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span> <span class="o">=</span> <span class="n">INT_NAN</span>


<div class="viewcode-block" id="get_tolerance"><a class="viewcode-back" href="../../../variabletools.html#hydpy.core.variabletools.get_tolerance">[docs]</a><span class="k">def</span> <span class="nf">get_tolerance</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return some &quot;numerical accuracy&quot; to be expected for the</span>
<span class="sd">    given floating point value(s).</span>

<span class="sd">    The documentation on function |trim| explains also function</span>
<span class="sd">    |get_tolerance|.  However, note the special case of infinite</span>
<span class="sd">    input values, for which function |get_tolerance| returns zero:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.variabletools import get_tolerance</span>
<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; get_tolerance(numpy.inf)</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import round_</span>
<span class="sd">    &gt;&gt;&gt; round_(get_tolerance(</span>
<span class="sd">    ...     numpy.array([1.0, numpy.inf, 2.0, -numpy.inf])), 16)</span>
<span class="sd">    0.000000000000001, 0.0, 0.000000000000002, 0.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tolerance</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="o">*</span><span class="mf">1e-15</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tolerance</span><span class="p">,</span> <span class="s1">&#39;__setitem__&#39;</span><span class="p">):</span>
        <span class="n">tolerance</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">tolerance</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">tolerance</span><span class="p">):</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">return</span> <span class="n">tolerance</span></div>


<span class="k">def</span> <span class="nf">_warn_trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oldvalue</span><span class="p">,</span> <span class="n">newvalue</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">warntrim</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;For variable {objecttools.devicephrase(self)} at least one &#39;</span>
            <span class="n">f</span><span class="s1">&#39;value needed to be trimmed.  The old and the new value(s) &#39;</span>
            <span class="n">f</span><span class="s1">&#39;are `{objecttools.repr_numbers(oldvalue)}` and &#39;</span>
            <span class="n">f</span><span class="s1">&#39;`{objecttools.repr_numbers(newvalue)}`, respectively.&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_compare_variables_function_generator</span><span class="p">(</span>
        <span class="n">method_string</span><span class="p">,</span> <span class="n">aggregation_func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a function to be used as a comparison method for class |Variable|.</span>

<span class="sd">    Pass the specific method (e.g. `__eq__`) and the corresponding</span>
<span class="sd">    operator (e.g. `==`) as strings.  Also pass either |numpy.all| or</span>
<span class="sd">    |numpy.any| for aggregating multiple boolean values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">comparison_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for comparison functions for class |Variable|.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">method_string</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;__eq__&#39;</span><span class="p">,</span> <span class="s1">&#39;__le__&#39;</span><span class="p">,</span> <span class="s1">&#39;__ge__&#39;</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">method_string</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="s1">&#39;__hydpy__get_value__&#39;</span><span class="p">):</span>
                <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">__hydpy__get_value__</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">aggregation_func</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to compare variable &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.elementphrase(self)} with object &#39;</span>
                <span class="n">f</span><span class="s1">&#39;`</span><span class="si">{other}</span><span class="s1">` of type `{objecttools.classname(other)}`&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">comparison_function</span>


<div class="viewcode-block" id="Variable"><a class="viewcode-back" href="../../../variabletools.html#hydpy.core.variabletools.Variable">[docs]</a><span class="k">class</span> <span class="nc">Variable</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">SubgroupType</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Base class for |Parameter| and |Sequence|.</span>

<span class="sd">    The subclasses are required to provide the class attributes `NDIM`</span>
<span class="sd">    and `TYPE`, defining the dimensionality and the type of the values</span>
<span class="sd">    to be handled by the subclass, respectively.  Class attribute `INIT`</span>
<span class="sd">    is optional and should provide a suitable default value.</span>

<span class="sd">    Class |Variable| implements methods for arithmetic calculations,</span>
<span class="sd">    comparisons and type conversions.  See the  following examples on</span>
<span class="sd">    how to do math with HydPys |Parameter| and |Sequence| objects.</span>

<span class="sd">    We start with demonstrating the supported mathematical operations</span>
<span class="sd">    on 0-dimensional |Variable| objects handling |float| values:</span>

<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.core.variabletools import Variable</span>
<span class="sd">    &gt;&gt;&gt; class Var(Variable):</span>
<span class="sd">    ...     NDIM = 0</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     __hydpy__connect_variable2subgroup__ = None</span>
<span class="sd">    ...     initinfo = 0.0, False</span>
<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>

<span class="sd">    You can perform additions both with other |Variable| objects and</span>
<span class="sd">    with ordinary number objects:</span>

<span class="sd">    &gt;&gt;&gt; var.value = 2.0</span>
<span class="sd">    &gt;&gt;&gt; var + var</span>
<span class="sd">    4.0</span>
<span class="sd">    &gt;&gt;&gt; var + 3.0</span>
<span class="sd">    5.0</span>
<span class="sd">    &gt;&gt;&gt; 4.0 + var</span>
<span class="sd">    6.0</span>
<span class="sd">    &gt;&gt;&gt; var += 1</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(3.0)</span>
<span class="sd">    &gt;&gt;&gt; var += -1.0</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(2.0)</span>

<span class="sd">    In case something went wrong, all math operations return errors</span>
<span class="sd">    like the following:</span>

<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var + 1.0</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: While trying to add variable `var` and `float` instance \</span>
<span class="sd">`1.0`, the following error occurred: For variable `var`, no value has been \</span>
<span class="sd">defined so far.</span>

<span class="sd">    In general, the examples above are valid for the following binary</span>
<span class="sd">    operations:</span>

<span class="sd">    &gt;&gt;&gt; var.value = 3.0</span>
<span class="sd">    &gt;&gt;&gt; var - 1</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; 7.0 - var</span>
<span class="sd">    4.0</span>
<span class="sd">    &gt;&gt;&gt; var -= 2.0</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(1.0)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 2.0</span>
<span class="sd">    &gt;&gt;&gt; var * 3</span>
<span class="sd">    6.0</span>
<span class="sd">    &gt;&gt;&gt; 4.0 * var</span>
<span class="sd">    8.0</span>
<span class="sd">    &gt;&gt;&gt; var *= 0.5</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(1.0)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 3.0</span>
<span class="sd">    &gt;&gt;&gt; var / 2</span>
<span class="sd">    1.5</span>
<span class="sd">    &gt;&gt;&gt; 7.5 / var</span>
<span class="sd">    2.5</span>
<span class="sd">    &gt;&gt;&gt; var /= 6.0</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(0.5)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 3.0</span>
<span class="sd">    &gt;&gt;&gt; var // 2</span>
<span class="sd">    1.0</span>
<span class="sd">    &gt;&gt;&gt; 7.5 // var</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; var //= 0.9</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(3.0)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 5.0</span>
<span class="sd">    &gt;&gt;&gt; var % 2</span>
<span class="sd">    1.0</span>
<span class="sd">    &gt;&gt;&gt; 7.5 % var</span>
<span class="sd">    2.5</span>
<span class="sd">    &gt;&gt;&gt; var %= 3.0</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(2.0)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 2.0</span>
<span class="sd">    &gt;&gt;&gt; var**3</span>
<span class="sd">    8.0</span>
<span class="sd">    &gt;&gt;&gt; 3.0**var</span>
<span class="sd">    9.0</span>
<span class="sd">    &gt;&gt;&gt; var **= 4.0</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(16.0)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 5.0</span>
<span class="sd">    &gt;&gt;&gt; divmod(var, 3)</span>
<span class="sd">    (1.0, 2.0)</span>
<span class="sd">    &gt;&gt;&gt; divmod(13.0, var)</span>
<span class="sd">    (2.0, 3.0)</span>

<span class="sd">    Additionally, we support the following unary operations:</span>

<span class="sd">    &gt;&gt;&gt; var.values = -5.0</span>
<span class="sd">    &gt;&gt;&gt; +var</span>
<span class="sd">    -5.0</span>
<span class="sd">    &gt;&gt;&gt; -var</span>
<span class="sd">    5.0</span>
<span class="sd">    &gt;&gt;&gt; abs(var)</span>
<span class="sd">    5.0</span>
<span class="sd">    &gt;&gt;&gt; ~var</span>
<span class="sd">    -0.2</span>
<span class="sd">    &gt;&gt;&gt; var.value = 2.5</span>
<span class="sd">    &gt;&gt;&gt; import math</span>
<span class="sd">    &gt;&gt;&gt; math.floor(var)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; math.ceil(var)</span>
<span class="sd">    3</span>
<span class="sd">    &gt;&gt;&gt; bool(var)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; int(var)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; float(var)</span>
<span class="sd">    2.5</span>
<span class="sd">    &gt;&gt;&gt; var.value = 1.67</span>
<span class="sd">    &gt;&gt;&gt; round(var, 1)</span>
<span class="sd">    1.7</span>

<span class="sd">    You can apply all the operations discussed above (except |float| and</span>
<span class="sd">    |int|) on |Variable| objects of arbitrary dimensionality:</span>

<span class="sd">    &gt;&gt;&gt; Var.NDIM = 1</span>
<span class="sd">    &gt;&gt;&gt; Var.TYPE = float</span>
<span class="sd">    &gt;&gt;&gt; var.shape = (2,)</span>
<span class="sd">    &gt;&gt;&gt; var.values = 2.0</span>
<span class="sd">    &gt;&gt;&gt; var + var</span>
<span class="sd">    array([ 4.,  4.])</span>
<span class="sd">    &gt;&gt;&gt; var + 3.0</span>
<span class="sd">    array([ 5.,  5.])</span>
<span class="sd">    &gt;&gt;&gt; [4.0, 0.0] + var</span>
<span class="sd">    array([ 6.,  2.])</span>
<span class="sd">    &gt;&gt;&gt; var += 1</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(3.0, 3.0)</span>

<span class="sd">    &gt;&gt;&gt; var.values = 3.0</span>
<span class="sd">    &gt;&gt;&gt; var - [1.0, 0.0]</span>
<span class="sd">    array([ 2.,  3.])</span>
<span class="sd">    &gt;&gt;&gt; [7.0, 0.0] - var</span>
<span class="sd">    array([ 4., -3.])</span>
<span class="sd">    &gt;&gt;&gt; var -= [2.0, 0.0]</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(1.0, 3.0)</span>

<span class="sd">    &gt;&gt;&gt; var.values = 2.0</span>
<span class="sd">    &gt;&gt;&gt; var * [3.0, 1.0]</span>
<span class="sd">    array([ 6.,  2.])</span>
<span class="sd">    &gt;&gt;&gt; [4.0, 1.0] * var</span>
<span class="sd">    array([ 8.,  2.])</span>
<span class="sd">    &gt;&gt;&gt; var *= [0.5, 1.0]</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(1.0, 2.0)</span>

<span class="sd">    &gt;&gt;&gt; var.values = 3.0</span>
<span class="sd">    &gt;&gt;&gt; var / [2.0, 1.0]</span>
<span class="sd">    array([ 1.5,  3. ])</span>
<span class="sd">    &gt;&gt;&gt; [7.5, 3.0] / var</span>
<span class="sd">    array([ 2.5,  1. ])</span>
<span class="sd">    &gt;&gt;&gt; var /= [6.0, 1.]</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(0.5, 3.0)</span>

<span class="sd">    &gt;&gt;&gt; var.values = 3.0</span>
<span class="sd">    &gt;&gt;&gt; var // [2.0, 1.0]</span>
<span class="sd">    array([ 1.,  3.])</span>
<span class="sd">    &gt;&gt;&gt; [7.5, 3.0] // var</span>
<span class="sd">    array([ 2.,  1.])</span>
<span class="sd">    &gt;&gt;&gt; var //= [0.9, 1.0]</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(3.0, 3.0)</span>

<span class="sd">    &gt;&gt;&gt; var.values = 5.0</span>
<span class="sd">    &gt;&gt;&gt; var % [2.0, 5.0]</span>
<span class="sd">    array([ 1.,  0.])</span>
<span class="sd">    &gt;&gt;&gt; [7.5, 5.0] % var</span>
<span class="sd">    array([ 2.5,  0. ])</span>
<span class="sd">    &gt;&gt;&gt; var %= [3.0, 5.0]</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(2.0, 0.0)</span>

<span class="sd">    &gt;&gt;&gt; var.values = 2.0</span>
<span class="sd">    &gt;&gt;&gt; var**[3.0, 1.0]</span>
<span class="sd">    array([ 8.,  2.])</span>
<span class="sd">    &gt;&gt;&gt; [3.0, 1.0]**var</span>
<span class="sd">    array([ 9.,  1.])</span>
<span class="sd">    &gt;&gt;&gt; var **= [4.0, 1.0]</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(16.0, 2.0)</span>

<span class="sd">    &gt;&gt;&gt; var.value = 5.0</span>
<span class="sd">    &gt;&gt;&gt; divmod(var, [3.0, 5.0])</span>
<span class="sd">    (array([ 1.,  1.]), array([ 2.,  0.]))</span>
<span class="sd">    &gt;&gt;&gt; divmod([13.0, 5.0], var)</span>
<span class="sd">    (array([ 2.,  1.]), array([ 3.,  0.]))</span>

<span class="sd">    &gt;&gt;&gt; var.values = -5.0</span>
<span class="sd">    &gt;&gt;&gt; +var</span>
<span class="sd">    array([-5., -5.])</span>
<span class="sd">    &gt;&gt;&gt; -var</span>
<span class="sd">    array([ 5.,  5.])</span>
<span class="sd">    &gt;&gt;&gt; abs(var)</span>
<span class="sd">    array([ 5.,  5.])</span>
<span class="sd">    &gt;&gt;&gt; ~var</span>
<span class="sd">    array([-0.2, -0.2])</span>
<span class="sd">    &gt;&gt;&gt; var.value = 2.5</span>
<span class="sd">    &gt;&gt;&gt; import math</span>
<span class="sd">    &gt;&gt;&gt; math.floor(var)</span>
<span class="sd">    array([2, 2])</span>
<span class="sd">    &gt;&gt;&gt; math.ceil(var)</span>
<span class="sd">    array([3, 3])</span>
<span class="sd">    &gt;&gt;&gt; var.values = 1.67</span>
<span class="sd">    &gt;&gt;&gt; round(var, 1)</span>
<span class="sd">    array([ 1.7,  1.7])</span>
<span class="sd">    &gt;&gt;&gt; bool(var)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; int(var)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: The variable `var` is 1-dimensional and thus cannot be \</span>
<span class="sd">converted to a scalar int value.</span>
<span class="sd">    &gt;&gt;&gt; float(var)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: The variable `var` is 1-dimensional and thus cannot be \</span>
<span class="sd">converted to a scalar float value.</span>

<span class="sd">    Indexing is supported (for consistency reasons, even for</span>
<span class="sd">    0-dimensional variables):</span>

<span class="sd">    &gt;&gt;&gt; Var.NDIM = 0</span>
<span class="sd">    &gt;&gt;&gt; var.value = 5.0</span>
<span class="sd">    &gt;&gt;&gt; var[0] += var[0]</span>
<span class="sd">    &gt;&gt;&gt; var[:]</span>
<span class="sd">    10.0</span>
<span class="sd">    &gt;&gt;&gt; var[1]</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    IndexError: While trying to access the value(s) of variable `var` \</span>
<span class="sd">with key `1`, the following error occurred: The only allowed keys for \</span>
<span class="sd">0-dimensional variables are `0` and `:`.</span>

<span class="sd">    &gt;&gt;&gt; Var.NDIM = 1</span>
<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var.shape = (5,)</span>
<span class="sd">    &gt;&gt;&gt; var.value = 2.0, 4.0, 6.0, 8.0, 10.0</span>
<span class="sd">    &gt;&gt;&gt; var[0]</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; var[-1]</span>
<span class="sd">    10.0</span>
<span class="sd">    &gt;&gt;&gt; var[1:-1:2] = 2.0 * var[1:-1:2]</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(2.0, 8.0, 6.0, 16.0, 10.0)</span>
<span class="sd">    &gt;&gt;&gt; var[:] = &#39;test&#39;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to set the value(s) of variable `var` \</span>
<span class="sd">with key `slice(None, None, None)`, the following error occurred: \</span>
<span class="sd">could not convert string to float: &#39;test&#39;</span>

<span class="sd">    Comparisons with |Variable| objects containing multiple values</span>
<span class="sd">    return a single boolean value.  Two objects are equal if all of</span>
<span class="sd">    their value-pairs are equal, and they are unequal if at least</span>
<span class="sd">    one of their value-pairs is unequal:</span>

<span class="sd">    &gt;&gt;&gt; var.shape = (2,)</span>
<span class="sd">    &gt;&gt;&gt; var.values = 1.0, 3.0</span>
<span class="sd">    &gt;&gt;&gt; var == [0.0, 2.0], var == [1.0, 2.0], var == [1.0, 3.0]</span>
<span class="sd">    (False, False, True)</span>
<span class="sd">    &gt;&gt;&gt; var != [0.0, 2.0], var != [1.0, 2.0], var != [1.0, 3.0]</span>
<span class="sd">    (True, True, False)</span>

<span class="sd">    While either the `==` or the `!=` operator returns `True` (but not both),</span>
<span class="sd">    this must not be the case for the operator pairs `&lt;`and `&gt;=` as well as</span>
<span class="sd">    `&gt;` and `&lt;=`:</span>

<span class="sd">    &gt;&gt;&gt; var &lt; 2.0, var &lt; 3.0, var &lt; 4.0</span>
<span class="sd">    (False, False, True)</span>
<span class="sd">    &gt;&gt;&gt; var &lt;= 2.0, var &lt;= 3.0, var &lt;= 4.0</span>
<span class="sd">    (False, True, True)</span>
<span class="sd">    &gt;&gt;&gt; var &gt;= 0.0, var &gt;= 1.0, var &gt;= 2.0</span>
<span class="sd">    (True, True, False)</span>
<span class="sd">    &gt;&gt;&gt; var &gt; 0.0, var &gt; 1.0, var &gt; 2.0</span>
<span class="sd">    (True, False, False)</span>

<span class="sd">    Comparing wrongly shaped values does work for `==` and `!=` but</span>
<span class="sd">    results in errors for the other operations:</span>

<span class="sd">    &gt;&gt;&gt; var.values = 2.0</span>
<span class="sd">    &gt;&gt;&gt; var == [2.0], var != [2.0]</span>
<span class="sd">    (True, False)</span>
<span class="sd">    &gt;&gt;&gt; var == [2.0, 2.0, 2.0], var != [2.0, 2.0, 2.0]</span>
<span class="sd">    (False, True)</span>
<span class="sd">    &gt;&gt;&gt; var &lt; [2.0], var &lt;= [2.0], var &gt;= [2.0], var &gt; [2.0]</span>
<span class="sd">    (False, True, True, False)</span>
<span class="sd">    &gt;&gt;&gt; var &lt; [2.0, 2.0, 2.0]   # doctest: +ELLIPSIS</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to compare variable `var` of element `?` \</span>
<span class="sd">with object `[2.0, 2.0, 2.0]` of type `list`, the following error occurred: \</span>
<span class="sd">operands could not be broadcast together with shapes (2,) (3,)...</span>

<span class="sd">    You can compare different |Variable| objects directly with each other:</span>

<span class="sd">    &gt;&gt;&gt; from copy import deepcopy</span>
<span class="sd">    &gt;&gt;&gt; var &lt; var, var &lt; deepcopy(var)</span>
<span class="sd">    (False, False)</span>
<span class="sd">    &gt;&gt;&gt; var &lt;= var, var &lt;= deepcopy(var)</span>
<span class="sd">    (True, True)</span>
<span class="sd">    &gt;&gt;&gt; var == var, var == deepcopy(var)</span>
<span class="sd">    (True, True)</span>
<span class="sd">    &gt;&gt;&gt; var != var, var != deepcopy(var)</span>
<span class="sd">    (False, False)</span>
<span class="sd">    &gt;&gt;&gt; var &gt;= var, var &gt;= deepcopy(var)</span>
<span class="sd">    (True, True)</span>
<span class="sd">    &gt;&gt;&gt; var &gt; var, var &gt; deepcopy(var)</span>
<span class="sd">    (False, False)</span>

<span class="sd">    When asking for impossible comparisons, |trim| raises error</span>
<span class="sd">    like the following:</span>

<span class="sd">    &gt;&gt;&gt; var &lt; &#39;text&#39;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    TypeError: &#39;&lt;&#39; not supported between instances of &#39;Var&#39; and &#39;str&#39;</span>

<span class="sd">    The |len| operator always returns the total number of values handles</span>
<span class="sd">    by the variable according to the current shape:</span>

<span class="sd">    &gt;&gt;&gt; Var.NDIM = 0</span>
<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var.shape = ()</span>
<span class="sd">    &gt;&gt;&gt; len(var)</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; Var.NDIM = 1</span>
<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var.shape = (5,)</span>
<span class="sd">    &gt;&gt;&gt; len(var)</span>
<span class="sd">    5</span>
<span class="sd">    &gt;&gt;&gt; Var.NDIM = 3</span>
<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var.shape = (2, 1, 4)</span>
<span class="sd">    &gt;&gt;&gt; len(var)</span>
<span class="sd">    8</span>

<span class="sd">    |Variable| objects are hashable based on their |id| value for</span>
<span class="sd">    avoiding confusion when adding different but equal objects into</span>
<span class="sd">    one |set| or |dict| object.  The following examples show this</span>
<span class="sd">    behaviour by making deep copies of existing |Variable| objects:</span>

<span class="sd">    &gt;&gt;&gt; Var.NDIM = 0</span>
<span class="sd">    &gt;&gt;&gt; var1 = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var1.value = 5.0</span>
<span class="sd">    &gt;&gt;&gt; varset = set([var1])</span>
<span class="sd">    &gt;&gt;&gt; var1 in varset</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; var1.value = 7.0</span>
<span class="sd">    &gt;&gt;&gt; var1 in varset</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; var2 = deepcopy(var1)</span>
<span class="sd">    &gt;&gt;&gt; var1 == var2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; var2 in varset</span>
<span class="sd">    False</span>

<span class="sd">    &gt;&gt;&gt; Var.NDIM = 1</span>
<span class="sd">    &gt;&gt;&gt; var1 = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var1.shape = (2,)</span>
<span class="sd">    &gt;&gt;&gt; var1.value = 3.0, 5.0</span>
<span class="sd">    &gt;&gt;&gt; varset = set([var1])</span>
<span class="sd">    &gt;&gt;&gt; var1 in varset</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; var1[1] = 7.0</span>
<span class="sd">    &gt;&gt;&gt; var1 in varset</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; var2 = deepcopy(var1)</span>
<span class="sd">    &gt;&gt;&gt; var1 == var2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; var2 in varset</span>
<span class="sd">    False</span>

<span class="sd">    Enabling option |Options.reprcomments| adds the respective docstring</span>
<span class="sd">    header to the string representation of a variable:</span>

<span class="sd">    &gt;&gt;&gt; Var.NDIM = 0</span>
<span class="sd">    &gt;&gt;&gt; Var.__doc__ = &#39;header.\\n\\nbody\\n&#39;</span>
<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var.value = 3.0</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; pub.options.reprcomments = True</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    # header.</span>
<span class="sd">    var(3.0)</span>

<span class="sd">    &gt;&gt;&gt; pub.options.reprcomments = False</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(3.0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Subclasses need to define...</span>
    <span class="n">NDIM</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">TYPE</span><span class="p">:</span> <span class="n">Type</span>
    <span class="c1"># ...and optionally...</span>
    <span class="n">SPAN</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">INIT</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">NOT_DEEPCOPYABLE_MEMBERS</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;subvars&#39;</span><span class="p">,</span> <span class="s1">&#39;fastaccess&#39;</span><span class="p">)</span>

    <span class="n">strict_valuehandling</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="s1">&#39;FastAccess&#39;</span><span class="p">,</span>
        <span class="n">typingtools</span><span class="o">.</span><span class="n">FastAccessParameterProtocol</span><span class="p">,</span>
        <span class="n">typingtools</span><span class="o">.</span><span class="n">FastAccessModelSequenceProtocol</span><span class="p">]</span>
    <span class="n">subvars</span><span class="p">:</span> <span class="n">SubgroupType</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">masktools</span><span class="o">.</span><span class="n">DefaultMask</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subvars</span><span class="p">:</span> <span class="n">SubgroupType</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subvars</span> <span class="o">=</span> <span class="n">subvars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span> <span class="o">=</span> <span class="n">FastAccess</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__valueready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shapeready</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">__hydpy__connect_variable2subgroup__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;To be called by the |SubVariables| object when preparing a</span>
<span class="sd">        new |Variable| object.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">initinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;To be overridden.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__hydpy__get_value__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual parameter or sequence value(s).</span>

<span class="sd">        First, we prepare a simple (not fully functional) |Variable| subclass:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.variabletools import Variable</span>
<span class="sd">        &gt;&gt;&gt; class Var(Variable):</span>
<span class="sd">        ...     NDIM = 0</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     __hydpy__connect_variable2subgroup__ = None</span>
<span class="sd">        ...     initinfo = 3.0, True</span>

<span class="sd">        Without making use of default values (see below), trying to</span>
<span class="sd">        query the actual value of a freshly initialised |Variable|</span>
<span class="sd">        object results in the following error:</span>

<span class="sd">        &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: For variable `var`, no value has been defined so far.</span>

<span class="sd">        Property |Variable.value| tries to normalise assigned values and</span>
<span class="sd">        raises an error, if not possible:</span>

<span class="sd">        &gt;&gt;&gt; var.value = 3</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        3.0</span>

<span class="sd">        &gt;&gt;&gt; var.value = [&#39;2.0&#39;]</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        2.0</span>

<span class="sd">        &gt;&gt;&gt; var.value = 1.0, 1.0</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to set the value(s) of variable `var`, the \</span>
<span class="sd">following error occurred: 2 values are assigned to the scalar variable `var`.</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        2.0</span>

<span class="sd">        &gt;&gt;&gt; var.value = &#39;O&#39;</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        TypeError: While trying to set the value(s) of variable `var`, \</span>
<span class="sd">the following error occurred: The given value `O` cannot be converted \</span>
<span class="sd">to type `float`.</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        2.0</span>

<span class="sd">        The above examples deal with a 0-dimensional variable handling</span>
<span class="sd">        |float| values.  The following examples focus on a 2-dimensional</span>
<span class="sd">        variable handling |int| values:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import INT_NAN</span>
<span class="sd">        &gt;&gt;&gt; Var.NDIM = 2</span>
<span class="sd">        &gt;&gt;&gt; Var.TYPE = int</span>
<span class="sd">        &gt;&gt;&gt; Var.initinfo = INT_NAN, False</span>

<span class="sd">        For multidimensional objects, assigning new values required</span>
<span class="sd">        defining their |Variable.shape| first:</span>

<span class="sd">        &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: Shape information for variable `var` can only be \</span>
<span class="sd">retrieved after it has been defined.</span>

<span class="sd">        &gt;&gt;&gt; var.value = 2</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: While trying to set the value(s) of variable `var`, \</span>
<span class="sd">the following error occurred: Shape information for variable `var` can only \</span>
<span class="sd">be retrieved after it has been defined.</span>

<span class="sd">        &gt;&gt;&gt; var.shape = (2, 3)</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: For variable `var`, no values have been defined so far.</span>

<span class="sd">        &gt;&gt;&gt; var.value = 2</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        array([[2, 2, 2],</span>
<span class="sd">               [2, 2, 2]])</span>

<span class="sd">        &gt;&gt;&gt; var.value = 1, 2</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to set the value(s) of variable `var`, \</span>
<span class="sd">the following error occurred: While trying to convert the value(s) `(1, 2)` \</span>
<span class="sd">to a numpy ndarray with shape `(2, 3)` and type `int`, the following error \</span>
<span class="sd">occurred: could not broadcast input array from shape (2) into shape (2,3)</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        array([[2, 2, 2],</span>
<span class="sd">               [2, 2, 2]])</span>

<span class="sd">        &gt;&gt;&gt; var.shape = (0, 0)</span>
<span class="sd">        &gt;&gt;&gt; var.shape</span>
<span class="sd">        (0, 0)</span>
<span class="sd">        &gt;&gt;&gt; var.value   # doctest: +ELLIPSIS</span>
<span class="sd">        array([], shape=(0, 0), dtype=int...)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_getvalue</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__valueready</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">strict_valuehandling</span><span class="p">,</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">substring</span> <span class="o">=</span> <span class="s1">&#39;values have&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="k">else</span> <span class="s1">&#39;value has&#39;</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;For variable {objecttools.devicephrase(self)}, &#39;</span>
                <span class="n">f</span><span class="s1">&#39;no </span><span class="si">{substring}</span><span class="s1"> been defined so far.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__hydpy__set_value__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_setvalue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__valueready</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to set the value(s) of variable &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)}&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_getvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readyflag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">readyflag</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_prepare_setvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;While trying to convert the value(s) `</span><span class="si">{value}</span><span class="s1">` &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;to a numpy ndarray with shape `</span><span class="si">{self.shape}</span><span class="s1">` &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;and type `{objecttools.classname(self.TYPE)}`&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="n">f</span><span class="s1">&#39;{len(value)} values are assigned to the scalar &#39;</span>
                        <span class="n">f</span><span class="s1">&#39;variable {objecttools.devicephrase(self)}.&#39;</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;The given value `</span><span class="si">{value}</span><span class="s1">` cannot be converted &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;to type `{objecttools.classname(self.TYPE)}`.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">__hydpy__get_value__</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">__hydpy__set_value__</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Alias for |Variable.value|.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__hydpy__get_value__</span><span class="p">()</span>

    <span class="nd">@values</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__hydpy__set_value__</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hydpy__get_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;A tuple containing the actual lengths of all dimensions.</span>

<span class="sd">        Note that setting a new |Variable.shape| results in a loss of</span>
<span class="sd">        the actual |Variable.values| of the respective |Variable| object.</span>

<span class="sd">        First, we prepare a simple (not fully functional) |Variable| subclass:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.variabletools import Variable</span>
<span class="sd">        &gt;&gt;&gt; class Var(Variable):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     __hydpy__connect_variable2subgroup__ = None</span>
<span class="sd">        ...     initinfo = 3.0, True</span>

<span class="sd">        Initially, the shape of a new |Variable| object is unknown:</span>

<span class="sd">        &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">        &gt;&gt;&gt; var.shape</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: Shape information for variable `var` can only be \</span>
<span class="sd">retrieved after it has been defined.</span>

<span class="sd">        For multidimensional objects, assigning shape information (as a</span>
<span class="sd">        |tuple| of |int| values) prepares the required array automatically.</span>
<span class="sd">        Due to the |Variable.initinfo| surrogate of our test class,</span>
<span class="sd">        the entries of this array are `3.0`:</span>

<span class="sd">        &gt;&gt;&gt; var.shape = (3,)</span>
<span class="sd">        &gt;&gt;&gt; var.shape</span>
<span class="sd">        (3,)</span>
<span class="sd">        &gt;&gt;&gt; var.values</span>
<span class="sd">        array([ 3.,  3.,  3.])</span>

<span class="sd">        For the |Variable.initinfo| flag (second |tuple| entry) being</span>
<span class="sd">        |False|, the array is still prepared but not directly accessible</span>
<span class="sd">        to the user:</span>

<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; Var.initinfo = numpy.nan, False</span>
<span class="sd">        &gt;&gt;&gt; var = Var(None)</span>

<span class="sd">        &gt;&gt;&gt; var.shape = (3,)</span>
<span class="sd">        &gt;&gt;&gt; var.shape</span>
<span class="sd">        (3,)</span>
<span class="sd">        &gt;&gt;&gt; var.values</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: For variable `var`, no values have been defined so far.</span>
<span class="sd">        &gt;&gt;&gt; var.fastaccess.var</span>
<span class="sd">        array([ nan,  nan,  nan])</span>

<span class="sd">        Property |Variable.shape| tries to normalise assigned values and</span>
<span class="sd">        raises errors like the following, if not possible:</span>

<span class="sd">        &gt;&gt;&gt; var.shape = &#39;x&#39;</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        TypeError: While trying create a new numpy ndarray for \</span>
<span class="sd">variable `var`, the following error occurred: &#39;str&#39; object cannot \</span>
<span class="sd">be interpreted as an integer</span>
<span class="sd">        &gt;&gt;&gt; hasattr(var, &#39;shape&#39;)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; var.fastaccess.var</span>

<span class="sd">        &gt;&gt;&gt; var.shape = (1,)</span>
<span class="sd">        &gt;&gt;&gt; hasattr(var, &#39;shape&#39;)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; var.shape = (2, 3)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: Variable `var` is 1-dimensional, but the given \</span>
<span class="sd">shape indicates `2` dimensions.</span>
<span class="sd">        &gt;&gt;&gt; hasattr(var, &#39;shape&#39;)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; var.fastaccess.var</span>


<span class="sd">        0-dimensional |Variable| objects inform the user about their shape</span>
<span class="sd">        but do not allow to change it for obvious reasons:</span>

<span class="sd">        &gt;&gt;&gt; class Var(Variable):</span>
<span class="sd">        ...     NDIM = 0</span>
<span class="sd">        ...     TYPE = int</span>
<span class="sd">        ...     __hydpy__connect_variable2subgroup__ = None</span>
<span class="sd">        ...     initinfo = 3, True</span>

<span class="sd">        &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">        &gt;&gt;&gt; var.shape</span>
<span class="sd">        ()</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: For variable `var`, no value has been defined so far.</span>

<span class="sd">        &gt;&gt;&gt; var.shape = ()</span>
<span class="sd">        &gt;&gt;&gt; var.shape</span>
<span class="sd">        ()</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        3</span>
<span class="sd">        &gt;&gt;&gt; var.shape = (2,)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: The shape information of 0-dimensional variables \</span>
<span class="sd">as `var` can only be `()`, but `(2,)` is given.</span>

<span class="sd">        With a |False| |Variable.initinfo| flag, the default value is</span>
<span class="sd">        still readily prepared after initialisation but not directly</span>
<span class="sd">        accessible to the user:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy import INT_NAN</span>
<span class="sd">        &gt;&gt;&gt; Var.initinfo = INT_NAN, False</span>
<span class="sd">        &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">        &gt;&gt;&gt; var.shape</span>
<span class="sd">        ()</span>
<span class="sd">        &gt;&gt;&gt; var.shape = ()</span>
<span class="sd">        &gt;&gt;&gt; hasattr(var, &#39;value&#39;)</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; var.fastaccess.var</span>
<span class="sd">        -999999</span>

<span class="sd">        &gt;&gt;&gt; var.value = 6</span>
<span class="sd">        &gt;&gt;&gt; var.value</span>
<span class="sd">        6</span>

<span class="sd">        &gt;&gt;&gt; var.shape = ()</span>
<span class="sd">        &gt;&gt;&gt; var.fastaccess.var</span>
<span class="sd">        -999999</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__shapeready</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;Shape information for variable &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)} can only &#39;</span>
                <span class="n">f</span><span class="s1">&#39;be retrieved after it has been defined.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">__hydpy__set_shape__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__valueready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shapeready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">initvalue</span><span class="p">,</span> <span class="n">initflag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initinfo</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">array</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
                    <span class="n">shape</span><span class="p">,</span> <span class="n">initvalue</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;While trying create a new numpy ndarray for variable &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)}&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;Variable {objecttools.devicephrase(self)} is &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.NDIM}</span><span class="s1">-dimensional, but the given &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;shape indicates `</span><span class="si">{array.ndim}</span><span class="s1">` dimensions.&#39;</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__shapeready</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shape</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">TYPE2MISSINGVALUE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raise_wrongshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fastaccess</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">initvalue</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">initflag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__valueready</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">shape</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">fget</span><span class="o">=</span><span class="n">__hydpy__get_shape__</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="n">__hydpy__set_shape__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_raise_wrongshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;The shape information of 0-dimensional variables &#39;</span>
            <span class="n">f</span><span class="s1">&#39;as {objecttools.devicephrase(self)} can only be `()`, &#39;</span>
            <span class="n">f</span><span class="s1">&#39;but `</span><span class="si">{shape}</span><span class="s1">` is given.&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Name of the class of the given instance in lower case letters.</span>

<span class="sd">        See the documentation on function |objecttools.get_name| for</span>
<span class="sd">        additional information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Variable.verify"><a class="viewcode-back" href="../../../variabletools.html#hydpy.core.variabletools.Variable.verify">[docs]</a>    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Raises a |RuntimeError| if at least one of the required values</span>
<span class="sd">        of a |Variable| object is |None| or |numpy.nan|. The descriptor</span>
<span class="sd">        `mask` defines, which values are considered to be necessary.</span>

<span class="sd">        Example on a 0-dimensional |Variable|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.variabletools import Variable</span>
<span class="sd">        &gt;&gt;&gt; class Var(Variable):</span>
<span class="sd">        ...     NDIM = 0</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     __hydpy__connect_variable2subgroup__ = None</span>
<span class="sd">        ...     initinfo = 0.0, False</span>
<span class="sd">        &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; var.shape = ()</span>
<span class="sd">        &gt;&gt;&gt; var.value = 1.0</span>
<span class="sd">        &gt;&gt;&gt; var.verify()</span>
<span class="sd">        &gt;&gt;&gt; var.value = numpy.nan</span>
<span class="sd">        &gt;&gt;&gt; var.verify()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: For variable `var`, 1 required value has not been set yet.</span>

<span class="sd">        Example on a 2-dimensional |Variable|:</span>

<span class="sd">        &gt;&gt;&gt; Var.NDIM = 2</span>
<span class="sd">        &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">        &gt;&gt;&gt; var.shape = (2, 3)</span>
<span class="sd">        &gt;&gt;&gt; var.value = numpy.ones((2,3))</span>
<span class="sd">        &gt;&gt;&gt; var.value[:, 1] = numpy.nan</span>
<span class="sd">        &gt;&gt;&gt; var.verify()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: For variable `var`, 2 required values \</span>
<span class="sd">have not been set yet.</span>

<span class="sd">        &gt;&gt;&gt; Var.mask = var.mask</span>
<span class="sd">        &gt;&gt;&gt; Var.mask[0, 1] = False</span>
<span class="sd">        &gt;&gt;&gt; var.verify()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        RuntimeError: For variable `var`, 1 required value has not been set yet.</span>

<span class="sd">        &gt;&gt;&gt; Var.mask[1, 1] = False</span>
<span class="sd">        &gt;&gt;&gt; var.verify()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nmbnan</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">nmbnan</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nmbnan</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;value has&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;values have&#39;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;For variable {objecttools.devicephrase(self)}, &#39;</span>
                <span class="n">f</span><span class="s1">&#39;</span><span class="si">{nmbnan}</span><span class="s1"> required </span><span class="si">{text}</span><span class="s1"> not been set yet.&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">refweights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Variable&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Reference to a |Parameter| object that defines weighting</span>
<span class="sd">        coefficients (e.g. fractional areas) for applying function</span>
<span class="sd">        |Variable.average_values|.  Must be overwritten by subclasses,</span>
<span class="sd">        when required.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="n">f</span><span class="s1">&#39;Variable {objecttools.devicephrase(self)} does &#39;</span>
            <span class="n">f</span><span class="s1">&#39;not define any weighting coefficients.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Variable.average_values"><a class="viewcode-back" href="../../../variabletools.html#hydpy.core.variabletools.Variable.average_values">[docs]</a>    <span class="k">def</span> <span class="nf">average_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Average the actual values of the |Variable| object.</span>

<span class="sd">        For 0-dimensional |Variable| objects, the result of method</span>
<span class="sd">        |Variable.average_values| equals |Variable.value|.  The</span>
<span class="sd">        following example shows this for the sloppily defined class</span>
<span class="sd">        `SoilMoisture`:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.variabletools import Variable</span>
<span class="sd">        &gt;&gt;&gt; class SoilMoisture(Variable):</span>
<span class="sd">        ...     NDIM = 0</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     refweigths = None</span>
<span class="sd">        ...     availablemasks = None</span>
<span class="sd">        ...     __hydpy__connect_variable2subgroup__ = None</span>
<span class="sd">        ...     initinfo = None</span>
<span class="sd">        &gt;&gt;&gt; sm = SoilMoisture(None)</span>
<span class="sd">        &gt;&gt;&gt; sm.value = 200.0</span>
<span class="sd">        &gt;&gt;&gt; sm.average_values()</span>
<span class="sd">        200.0</span>

<span class="sd">        When the dimensionality of this class is increased to one,</span>
<span class="sd">        applying method |Variable.average_values| results in the</span>
<span class="sd">        following error:</span>

<span class="sd">        &gt;&gt;&gt; SoilMoisture.NDIM = 1</span>
<span class="sd">        &gt;&gt;&gt; import numpy</span>
<span class="sd">        &gt;&gt;&gt; SoilMoisture.shape = (3,)</span>
<span class="sd">        &gt;&gt;&gt; SoilMoisture.value = numpy.array([200.0, 400.0, 500.0])</span>
<span class="sd">        &gt;&gt;&gt; sm.average_values()</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        AttributeError: While trying to calculate the mean value \</span>
<span class="sd">of variable `soilmoisture`, the following error occurred: Variable \</span>
<span class="sd">`soilmoisture` does not define any weighting coefficients.</span>

<span class="sd">        So model developers have to define another (in this case</span>
<span class="sd">        1-dimensional) |Variable| subclass (usually a |Parameter|</span>
<span class="sd">        subclass), and make the relevant object available via property</span>
<span class="sd">        |Variable.refweights|:</span>

<span class="sd">        &gt;&gt;&gt; class Area(Variable):</span>
<span class="sd">        ...     NDIM = 1</span>
<span class="sd">        ...     shape = (3,)</span>
<span class="sd">        ...     value = numpy.array([1.0, 1.0, 2.0])</span>
<span class="sd">        ...     __hydpy__connect_variable2subgroup__ = None</span>
<span class="sd">        ...     initinfo = None</span>
<span class="sd">        &gt;&gt;&gt; area = Area(None)</span>
<span class="sd">        &gt;&gt;&gt; SoilMoisture.refweights = property(lambda self: area)</span>
<span class="sd">        &gt;&gt;&gt; sm.average_values()</span>
<span class="sd">        400.0</span>

<span class="sd">        In the examples above, all single entries of `values` are relevant,</span>
<span class="sd">        which is the default case.  However, subclasses of |Variable| can</span>
<span class="sd">        define an alternative mask, allowing to make some entries</span>
<span class="sd">        irrelevant. Assume for example, that our `SoilMoisture` object</span>
<span class="sd">        contains three single values, each one associated with a specific</span>
<span class="sd">        hydrological response unit (hru).  To indicate that soil moisture</span>
<span class="sd">        is undefined for the third unit, (maybe because it is a water area),</span>
<span class="sd">        we set the third entry of the verification mask to |False|:</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.masktools import DefaultMask</span>
<span class="sd">        &gt;&gt;&gt; class Soil(DefaultMask):</span>
<span class="sd">        ...     @classmethod</span>
<span class="sd">        ...     def new(cls, variable, **kwargs):</span>
<span class="sd">        ...         return cls.array2mask([True, True, False])</span>
<span class="sd">        &gt;&gt;&gt; SoilMoisture.mask = Soil()</span>
<span class="sd">        &gt;&gt;&gt; sm.average_values()</span>
<span class="sd">        300.0</span>

<span class="sd">        Alternatively, method |Variable.average_values| accepts additional</span>
<span class="sd">        masking information as positional or keyword arguments.  Therefore,</span>
<span class="sd">        the corresponding model must implement some alternative masks,</span>
<span class="sd">        which are provided by property |Variable.availablemasks|.</span>
<span class="sd">        We mock this property with a new |Masks| object, handling one</span>
<span class="sd">        mask for flat soils (only the first hru), one mask for deep soils</span>
<span class="sd">        (only the second hru), and one mask for water areas (only the</span>
<span class="sd">        third hru):</span>

<span class="sd">        &gt;&gt;&gt; class FlatSoil(DefaultMask):</span>
<span class="sd">        ...     @classmethod</span>
<span class="sd">        ...     def new(cls, variable, **kwargs):</span>
<span class="sd">        ...         return cls.array2mask([True, False, False])</span>
<span class="sd">        &gt;&gt;&gt; class DeepSoil(DefaultMask):</span>
<span class="sd">        ...     @classmethod</span>
<span class="sd">        ...     def new(cls, variable, **kwargs):</span>
<span class="sd">        ...         return cls.array2mask([False, True, False])</span>
<span class="sd">        &gt;&gt;&gt; class Water(DefaultMask):</span>
<span class="sd">        ...     @classmethod</span>
<span class="sd">        ...     def new(cls, variable, **kwargs):</span>
<span class="sd">        ...         return cls.array2mask([False, False, True])</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core import masktools</span>
<span class="sd">        &gt;&gt;&gt; class Masks(masktools.Masks):</span>
<span class="sd">        ...     CLASSES = (FlatSoil,</span>
<span class="sd">        ...                DeepSoil,</span>
<span class="sd">        ...                Water)</span>
<span class="sd">        &gt;&gt;&gt; SoilMoisture.availablemasks = Masks(None)</span>

<span class="sd">        One can pass either the mask classes themselves or their names:</span>

<span class="sd">        &gt;&gt;&gt; sm.average_values(sm.availablemasks.flatsoil)</span>
<span class="sd">        200.0</span>
<span class="sd">        &gt;&gt;&gt; sm.average_values(&#39;deepsoil&#39;)</span>
<span class="sd">        400.0</span>

<span class="sd">        Both variants can be combined:</span>

<span class="sd">        &gt;&gt;&gt; sm.average_values(sm.availablemasks.deepsoil, &#39;flatsoil&#39;)</span>
<span class="sd">        300.0</span>

<span class="sd">        The following error happens if the general mask of the variable</span>
<span class="sd">        does not contain the given masks:</span>

<span class="sd">        &gt;&gt;&gt; sm.average_values(&#39;flatsoil&#39;, &#39;water&#39;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to calculate the mean value of variable \</span>
<span class="sd">`soilmoisture`, the following error occurred: Based on the arguments \</span>
<span class="sd">`(&#39;flatsoil&#39;, &#39;water&#39;)` and `{}` the mask `CustomMask([ True, False,  True])` \</span>
<span class="sd">has been determined, which is not a submask of `Soil([ True,  True, False])`.</span>

<span class="sd">        Applying masks with custom options is also supported.  One can change</span>
<span class="sd">        the behaviour of the following mask via the argument `complete`:</span>

<span class="sd">        &gt;&gt;&gt; class AllOrNothing(DefaultMask):</span>
<span class="sd">        ...     @classmethod</span>
<span class="sd">        ...     def new(cls, variable, complete):</span>
<span class="sd">        ...         if complete:</span>
<span class="sd">        ...             bools = [True, True, True]</span>
<span class="sd">        ...         else:</span>
<span class="sd">        ...             bools = [False, False, False]</span>
<span class="sd">        ...         return cls.array2mask(bools)</span>
<span class="sd">        &gt;&gt;&gt; class Masks(Masks):</span>
<span class="sd">        ...     CLASSES = (FlatSoil,</span>
<span class="sd">        ...                DeepSoil,</span>
<span class="sd">        ...                Water,</span>
<span class="sd">        ...                AllOrNothing)</span>
<span class="sd">        &gt;&gt;&gt; SoilMoisture.availablemasks = Masks(None)</span>

<span class="sd">        Again, one can apply the mask class directly (but note that one</span>
<span class="sd">        has to pass the relevant variable as the first argument.):</span>

<span class="sd">        &gt;&gt;&gt; sm.average_values(   # doctest: +ELLIPSIS</span>
<span class="sd">        ...     sm.availablemasks.allornothing(sm, complete=True))</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValueError: While trying to...</span>

<span class="sd">        Alternatively, one can pass the mask name as a keyword and pack</span>
<span class="sd">        the mask&#39;s options into a |dict| object:</span>

<span class="sd">        &gt;&gt;&gt; sm.average_values(allornothing={&#39;complete&#39;: False})</span>
<span class="sd">        nan</span>

<span class="sd">        You can combine all variants explained above:</span>

<span class="sd">        &gt;&gt;&gt; sm.average_values(</span>
<span class="sd">        ...     &#39;deepsoil&#39;, flatsoil={}, allornothing={&#39;complete&#39;: False})</span>
<span class="sd">        300.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_submask</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
                <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refweights</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="o">*</span><span class="bp">self</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to calculate the mean value of variable &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)}&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">availablemasks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">masktools</span><span class="o">.</span><span class="n">Masks</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;A |Masks| object provided by the corresponding |Model| object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">subvars</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">masks</span>

<div class="viewcode-block" id="Variable.get_submask"><a class="viewcode-back" href="../../../variabletools.html#hydpy.core.variabletools.Variable.get_submask">[docs]</a>    <span class="k">def</span> <span class="nf">get_submask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">masktools</span><span class="o">.</span><span class="n">CustomMask</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get a sub-mask of the mask handled by the actual |Variable| object</span>
<span class="sd">        based on the given arguments.</span>

<span class="sd">        See the documentation on method |Variable.average_values| for</span>
<span class="sd">        further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">masks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">availablemasks</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">masktools</span><span class="o">.</span><span class="n">CustomMask</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_mask</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">masks</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_mask</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">masks</span><span class="p">,</span> <span class="o">**</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mask</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;Based on the arguments `</span><span class="si">{args}</span><span class="s1">` and `</span><span class="si">{kwargs}</span><span class="s1">` &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;the mask `{repr(mask)}` has been determined, &#39;</span>
                    <span class="n">f</span><span class="s1">&#39;which is not a submask of `{repr(self.mask)}`.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span>
        <span class="k">return</span> <span class="n">mask</span></div>

    <span class="k">def</span> <span class="nf">_prepare_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">masks</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">masks</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">NOT_DEEPCOPYABLE_MEMBERS</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">memo</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">new</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to access the value(s) of variable &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)} with key `</span><span class="si">{key}</span><span class="s1">`&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to set the value(s) of variable &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)} with key `</span><span class="si">{key}</span><span class="s1">`&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
                <span class="s1">&#39;The only allowed keys for 0-dimensional variables &#39;</span>
                <span class="s1">&#39;are `0` and `:`.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_do_math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">methodname</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="s1">&#39;__hydpy__get_value__&#39;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">other</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">methodname</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">result</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TYPE</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">methodname</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">objecttools</span><span class="o">.</span><span class="n">augment_excmessage</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;While trying to </span><span class="si">{description}</span><span class="s1"> variable &#39;</span>
                <span class="n">f</span><span class="s1">&#39;{objecttools.devicephrase(self)} and &#39;</span>
                <span class="n">f</span><span class="s1">&#39;`{objecttools.classname(other)}` instance `</span><span class="si">{other}</span><span class="s1">`&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__add__&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__radd__&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__add__&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__sub__&#39;</span><span class="p">,</span> <span class="s1">&#39;subtract&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__rsub__&#39;</span><span class="p">,</span> <span class="s1">&#39;subtract&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__sub__&#39;</span><span class="p">,</span> <span class="s1">&#39;subtract&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__mul__&#39;</span><span class="p">,</span> <span class="s1">&#39;multiply&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__rmul__&#39;</span><span class="p">,</span> <span class="s1">&#39;multiply&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__mul__&#39;</span><span class="p">,</span> <span class="s1">&#39;multiply&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__truediv__&#39;</span><span class="p">,</span> <span class="s1">&#39;divide&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__rtruediv__&#39;</span><span class="p">,</span> <span class="s1">&#39;divide&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__truediv__&#39;</span><span class="p">,</span> <span class="s1">&#39;divide&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__floordiv__&#39;</span><span class="p">,</span> <span class="s1">&#39;floor divide&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__rfloordiv__&#39;</span><span class="p">,</span> <span class="s1">&#39;floor divide&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ifloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__floordiv__&#39;</span><span class="p">,</span> <span class="s1">&#39;floor divide&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__mod__&#39;</span><span class="p">,</span> <span class="s1">&#39;mod divide&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__rmod__&#39;</span><span class="p">,</span> <span class="s1">&#39;mod divide&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__imod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__mod__&#39;</span><span class="p">,</span> <span class="s1">&#39;mod divide&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__divmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__floordiv__</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__mod__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rdivmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__rfloordiv__</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__rmod__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__pow__&#39;</span><span class="p">,</span> <span class="s1">&#39;exponentiate&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__rpow__&#39;</span><span class="p">,</span> <span class="s1">&#39;exponentiate (reflectively)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ipow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__pow__&#39;</span><span class="p">,</span> <span class="s1">&#39;exponentiate&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">__floor__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">//</span> <span class="mf">1.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__ceil__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="fm">__lt__</span> <span class="o">=</span> <span class="n">_compare_variables_function_generator</span><span class="p">(</span><span class="s1">&#39;__lt__&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
    <span class="fm">__le__</span> <span class="o">=</span> <span class="n">_compare_variables_function_generator</span><span class="p">(</span><span class="s1">&#39;__le__&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
    <span class="fm">__eq__</span> <span class="o">=</span> <span class="n">_compare_variables_function_generator</span><span class="p">(</span><span class="s1">&#39;__eq__&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
    <span class="fm">__ne__</span> <span class="o">=</span> <span class="n">_compare_variables_function_generator</span><span class="p">(</span><span class="s1">&#39;__ne__&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">any</span><span class="p">)</span>
    <span class="fm">__ge__</span> <span class="o">=</span> <span class="n">_compare_variables_function_generator</span><span class="p">(</span><span class="s1">&#39;__ge__&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
    <span class="fm">__gt__</span> <span class="o">=</span> <span class="n">_compare_variables_function_generator</span><span class="p">(</span><span class="s1">&#39;__gt__&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_typeconversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;The variable {objecttools.devicephrase(self)} is &#39;</span>
                <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.NDIM}</span><span class="s1">-dimensional and thus cannot be converted &#39;</span>
                <span class="n">f</span><span class="s1">&#39;to a scalar {objecttools.classname(type_)} value.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">type_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_typeconversion</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_typeconversion</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__round__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">commentrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;A list with comments for making string representations</span>
<span class="sd">        more informative.</span>

<span class="sd">        With option |Options.reprcomments| being disabled,</span>
<span class="sd">        |Variable.commentrepr| is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">reprcomments</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="s1">&#39;# </span><span class="si">{line}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span>
                    <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">objecttools</span><span class="o">.</span><span class="n">description</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">72</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">to_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="SubVariables"><a class="viewcode-back" href="../../../variabletools.html#hydpy.core.variabletools.SubVariables">[docs]</a><span class="k">class</span> <span class="nc">SubVariables</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">GroupType</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Base class for |SubParameters| and |SubSequences|.</span>

<span class="sd">    Each subclass of class |SubVariables| is thought for handling a certain</span>
<span class="sd">    group of |Parameter| or |Sequence| objects.  One specific example is</span>
<span class="sd">    subclass |sequencetools.InputSequences|, collecting all |InputSequence|</span>
<span class="sd">    objects of a specific hydrological model.</span>

<span class="sd">    For the following examples, we first prepare a (not fully</span>
<span class="sd">    functional) |Variable| subclass:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.variabletools import SubVariables, Variable</span>
<span class="sd">    &gt;&gt;&gt; class TestVar(Variable):</span>
<span class="sd">    ...     NDIM = 0</span>
<span class="sd">    ...     TYPE = float</span>
<span class="sd">    ...     __hydpy__connect_variable2subgroup__ = lambda self: None</span>
<span class="sd">    ...     initinfo = 0.0, False</span>

<span class="sd">    Out test |SubVariables| subclass is thought to handle only this</span>
<span class="sd">    single |Variable| subclass, indicated by putting it into the</span>
<span class="sd">    |tuple| class attribute `CLASSES`:</span>

<span class="sd">    &gt;&gt;&gt; class SubVars(SubVariables):</span>
<span class="sd">    ...     CLASSES = (TestVar,)</span>
<span class="sd">    ...     def __hydpy__initialise_fastaccess__(self):</span>
<span class="sd">    ...         return None</span>
<span class="sd">    ...     name = &#39;subvars&#39;</span>

<span class="sd">    After initialisation, |SubVariables| objects reference their master</span>
<span class="sd">    object (either a |Parameters| or a |Sequences| object), passed to their</span>
<span class="sd">    constructor. However, in our simple test example, we just passed</span>
<span class="sd">    a string instead:</span>

<span class="sd">    &gt;&gt;&gt; subvars = SubVars(&#39;test&#39;)</span>
<span class="sd">    &gt;&gt;&gt; subvars.vars</span>
<span class="sd">    &#39;test&#39;</span>

<span class="sd">    The string representation lists all available variables and,</span>
<span class="sd">    with the option |Options.reprcomments| enabled, an additional</span>
<span class="sd">    informative header:</span>

<span class="sd">    &gt;&gt;&gt; subvars</span>
<span class="sd">    testvar(?)</span>
<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; pub.options.reprcomments = True</span>
<span class="sd">    &gt;&gt;&gt; subvars</span>
<span class="sd">    # SubVars object defined in module variabletools,</span>
<span class="sd">    # handling the following variables:</span>
<span class="sd">    testvar(?)</span>
<span class="sd">    &gt;&gt;&gt; pub.options.reprcomments = False</span>

<span class="sd">    Class |SubVariables| provides attribute access to the handled</span>
<span class="sd">    |Variable| objects, and protects |Variable| objects from</span>
<span class="sd">    accidental overwriting:</span>

<span class="sd">    &gt;&gt;&gt; subvars.testvar = 3.0</span>
<span class="sd">    &gt;&gt;&gt; subvars.testvar</span>
<span class="sd">    testvar(3.0)</span>

<span class="sd">    Trying to query not available |Variable| objects (or other attributes)</span>
<span class="sd">    results in the following error message:</span>

<span class="sd">    &gt;&gt;&gt; subvars.wrong</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: Collection object `subvars` does neither handle a \</span>
<span class="sd">variable nor another attribute named wrong.</span>

<span class="sd">    Class |SubVariables| protects only the handled |Variable| objects</span>
<span class="sd">    from overwriting with unplausible data:</span>

<span class="sd">    &gt;&gt;&gt; subvars.vars = &#39;wrong&#39;</span>
<span class="sd">    &gt;&gt;&gt; subvars.vars</span>
<span class="sd">    &#39;wrong&#39;</span>

<span class="sd">    &gt;&gt;&gt; subvars.testvar = &#39;wrong&#39;</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    ValueError: While trying to set the value(s) of variable `testvar`, \</span>
<span class="sd">the following error occurred: 5 values are assigned to the scalar \</span>
<span class="sd">variable `testvar`.</span>

<span class="sd">    Class |SubVariables| supporte iteration and the application of the</span>
<span class="sd">    |len| operator:</span>

<span class="sd">    &gt;&gt;&gt; for variable in subvars:</span>
<span class="sd">    ...     print(variable.name)</span>
<span class="sd">    testvar</span>
<span class="sd">    &gt;&gt;&gt; len(subvars)</span>
<span class="sd">    1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CLASSES</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">typingtools</span><span class="o">.</span><span class="n">VariableProtocol</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
    <span class="nb">vars</span><span class="p">:</span> <span class="n">GroupType</span>
    <span class="n">_name2variable</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typingtools</span><span class="o">.</span><span class="n">VariableProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fastaccess</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="s1">&#39;FastAccess&#39;</span><span class="p">,</span>
        <span class="n">typingtools</span><span class="o">.</span><span class="n">FastAccessParameterProtocol</span><span class="p">,</span>
        <span class="n">typingtools</span><span class="o">.</span><span class="n">FastAccessModelSequenceProtocol</span><span class="p">]</span>
    <span class="n">_cls_fastaccess</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span>
        <span class="n">Type</span><span class="p">[</span><span class="n">typingtools</span><span class="o">.</span><span class="n">FastAccessParameterProtocol</span><span class="p">],</span>
        <span class="n">Type</span><span class="p">[</span><span class="n">typingtools</span><span class="o">.</span><span class="n">FastAccessModelSequenceProtocol</span><span class="p">]]]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="n">master</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__hydpy__initialise_fastaccess__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name2variable</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">:</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name2variable</span><span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">__hydpy__connect_variable2subgroup__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;To be overridden.&quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">__hydpy__initialise_fastaccess__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;To be overridden.  Must create a `fastaccess` attribute and build</span>
<span class="sd">        the required connections to the related cythonized model eventually.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2variable</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="n">f</span><span class="s1">&#39;Collection object {objecttools.devicephrase(self)} &#39;</span>
                <span class="n">f</span><span class="s1">&#39;does neither handle a variable nor another attribute &#39;</span>
                <span class="n">f</span><span class="s1">&#39;named </span><span class="si">{name}</span><span class="s1">.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2variable</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">variable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">__hydpy__set_value__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name2variable</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">variable</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CLASSES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">hydpy</span><span class="o">.</span><span class="n">pub</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">reprcomments</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;# {objecttools.classname(self)} object defined &#39;</span>
                         <span class="n">f</span><span class="s1">&#39;in module {objecttools.modulename(self)},</span><span class="se">\n</span><span class="s1">&#39;</span>
                         <span class="n">f</span><span class="s1">&#39;# handling the following variables:&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">variable</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{variable.name}</span><span class="s1">(?)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; from hydpy.core.variabletools import SubVariables, Variable</span>
<span class="sd">        &gt;&gt;&gt; class TestVar(Variable):</span>
<span class="sd">        ...     NDIM = 0</span>
<span class="sd">        ...     TYPE = float</span>
<span class="sd">        ...     __hydpy__connect_variable2subgroup__ = lambda self: None</span>
<span class="sd">        ...     initinfo = 0.0, False</span>
<span class="sd">        &gt;&gt;&gt; class TestSubVars(SubVariables):</span>
<span class="sd">        ...     CLASSES = (TestVar,)</span>
<span class="sd">        ...     __hydpy__initialise_fastaccess__ = lambda self: None</span>
<span class="sd">        ...     name = None</span>
<span class="sd">        &gt;&gt;&gt; dir(TestSubVars(None))</span>
<span class="sd">        [&#39;CLASSES&#39;, &#39;name&#39;, &#39;testvar&#39;, &#39;vars&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name2variable</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="to_repr"><a class="viewcode-back" href="../../../variabletools.html#hydpy.core.variabletools.to_repr">[docs]</a><span class="k">def</span> <span class="nf">to_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Variable</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">brackets1d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> \
        <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return a valid string representation for the given |Variable|</span>
<span class="sd">    object.</span>

<span class="sd">    Function |to_repr| is thought for internal purposes only, more</span>
<span class="sd">    specifically for defining string representations of subclasses</span>
<span class="sd">    of class |Variable| like the following:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.variabletools import to_repr, Variable</span>
<span class="sd">    &gt;&gt;&gt; class Var(Variable):</span>
<span class="sd">    ...     NDIM = 0</span>
<span class="sd">    ...     TYPE = int</span>
<span class="sd">    ...     __hydpy__connect_variable2subgroup__ = None</span>
<span class="sd">    ...     initinfo = 1.0, False</span>
<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var.value = 2</span>
<span class="sd">    &gt;&gt;&gt; var</span>
<span class="sd">    var(2)</span>

<span class="sd">    The following examples demonstrate all covered cases.  Note that</span>
<span class="sd">    option `brackets1d` allows choosing between a &quot;vararg&quot; and an</span>
<span class="sd">    &quot;iterable&quot; string representation for 1-dimensional variables</span>
<span class="sd">    (the first one being the default):</span>

<span class="sd">    &gt;&gt;&gt; print(to_repr(var, 2))</span>
<span class="sd">    var(2)</span>

<span class="sd">    &gt;&gt;&gt; Var.NDIM = 1</span>
<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var.shape = 3</span>
<span class="sd">    &gt;&gt;&gt; print(to_repr(var, range(3)))</span>
<span class="sd">    var(0, 1, 2)</span>
<span class="sd">    &gt;&gt;&gt; print(to_repr(var, range(3), True))</span>
<span class="sd">    var([0, 1, 2])</span>
<span class="sd">    &gt;&gt;&gt; print(to_repr(var, range(30)))</span>
<span class="sd">    var(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,</span>
<span class="sd">        19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29)</span>
<span class="sd">    &gt;&gt;&gt; print(to_repr(var, range(30), True))</span>
<span class="sd">    var([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,</span>
<span class="sd">         19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29])</span>

<span class="sd">    &gt;&gt;&gt; Var.NDIM = 2</span>
<span class="sd">    &gt;&gt;&gt; var = Var(None)</span>
<span class="sd">    &gt;&gt;&gt; var.shape = (2, 3)</span>
<span class="sd">    &gt;&gt;&gt; print(to_repr(var, [range(3), range(3, 6)]))</span>
<span class="sd">    var([[0, 1, 2],</span>
<span class="sd">         [3, 4, 5]])</span>
<span class="sd">    &gt;&gt;&gt; print(to_repr(var, [range(30), range(30, 60)]))</span>
<span class="sd">    var([[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,</span>
<span class="sd">          19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29],</span>
<span class="sd">         [30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45,</span>
<span class="sd">          46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1">(&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1">(</span><span class="si">{values}</span><span class="s1">)&#39;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{self.name}</span><span class="s1">({objecttools.repr_(values)})&#39;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDIM</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">brackets1d</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_values</span><span class="p">(</span>
                <span class="n">values</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list2</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="mi">72</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commentrepr</span> <span class="o">+</span> <span class="p">[</span><span class="n">string</span><span class="p">])</span></div>


<div class="viewcode-block" id="FastAccess"><a class="viewcode-back" href="../../../variabletools.html#hydpy.core.variabletools.FastAccess">[docs]</a><span class="k">class</span> <span class="nc">FastAccess</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Used as a surrogate for typed Cython classes handling parameters or</span>
<span class="sd">    sequences when working in pure Python mode.&quot;&quot;&quot;</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/HydPy_Logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Example Projects</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 4.0a11 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, HydPy Developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>